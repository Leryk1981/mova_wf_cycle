data: {"type":"server.connected","properties":{}}

data: {"type":"session.created","properties":{"info":{"id":"ses_4d6c125baffe3wHTNInEmsOJ7Q","version":"local","projectID":"global","directory":"/work","title":"New session - 2025-12-16T22:19:03.621Z","time":{"created":1765923543621,"updated":1765923543621}}}}

data: {"type":"session.updated","properties":{"info":{"id":"ses_4d6c125baffe3wHTNInEmsOJ7Q","version":"local","projectID":"global","directory":"/work","title":"New session - 2025-12-16T22:19:03.621Z","time":{"created":1765923543621,"updated":1765923543621}}}}

data: {"type":"message.updated","properties":{"info":{"id":"msg_b293eda77001xVRhCZRpRucie1","sessionID":"ses_4d6c125baffe3wHTNInEmsOJ7Q","role":"user","time":{"created":1765923543671},"agent":"general","model":{"providerID":"opencode","modelID":"big-pickle"}}}}

data: {"type":"message.part.updated","properties":{"part":{"id":"prt_b293eda8300157QQ7ihUFSnYY9","sessionID":"ses_4d6c125baffe3wHTNInEmsOJ7Q","messageID":"msg_b293eda77001xVRhCZRpRucie1","type":"text","text":"The following tool was executed by the user","synthetic":true}}}

data: {"type":"message.updated","properties":{"info":{"id":"msg_b293edaae001q0udHeP63Aeoji","sessionID":"ses_4d6c125baffe3wHTNInEmsOJ7Q","role":"assistant","time":{"created":1765923543726},"parentID":"msg_b293eda77001xVRhCZRpRucie1","modelID":"big-pickle","providerID":"opencode","mode":"general","agent":"general","path":{"cwd":"/work","root":"/work"},"cost":0,"tokens":{"input":0,"output":0,"reasoning":0,"cache":{"read":0,"write":0}}}}}

data: {"type":"message.part.updated","properties":{"part":{"id":"prt_b293edaba0011QdVm15Gud3hir","sessionID":"ses_4d6c125baffe3wHTNInEmsOJ7Q","messageID":"msg_b293edaae001q0udHeP63Aeoji","type":"tool","callID":"01KCMKXPNTE097TER81QD4V0HM","tool":"bash","state":{"status":"running","input":{"command":"ls -la -- '/work/packages/opencode/src/server/'"},"time":{"start":1765923543738}}}}}

data: {"type":"message.part.updated","properties":{"part":{"id":"prt_b293edaba0011QdVm15Gud3hir","sessionID":"ses_4d6c125baffe3wHTNInEmsOJ7Q","messageID":"msg_b293edaae001q0udHeP63Aeoji","type":"tool","callID":"01KCMKXPNTE097TER81QD4V0HM","tool":"bash","state":{"status":"running","input":{"command":"ls -la -- '/work/packages/opencode/src/server/'"},"metadata":{"output":"total 100\ndrwxrwxrwx  2 root root  4096 Dec 16 16:57 .\ndrwxrwxrwx 34 root root  4096 Dec 16 16:57 ..\n-rwxrwxrwx  1 root root   875 Dec 16 16:57 error.ts\n-rwxrwxrwx  1 root root  2272 Dec 16 16:57 project.ts\n-rwxrwxrwx  1 root root 79064 Dec 16 16:57 server.ts\n-rwxrwxrwx  1 root root  1828 Dec 16 16:57 tui.ts\n","description":""},"time":{"start":1765923543738}}}}}

data: {"type":"message.updated","properties":{"info":{"id":"msg_b293edaae001q0udHeP63Aeoji","sessionID":"ses_4d6c125baffe3wHTNInEmsOJ7Q","role":"assistant","time":{"created":1765923543726,"completed":1765923543840},"parentID":"msg_b293eda77001xVRhCZRpRucie1","modelID":"big-pickle","providerID":"opencode","mode":"general","agent":"general","path":{"cwd":"/work","root":"/work"},"cost":0,"tokens":{"input":0,"output":0,"reasoning":0,"cache":{"read":0,"write":0}}}}}

data: {"type":"message.part.updated","properties":{"part":{"id":"prt_b293edaba0011QdVm15Gud3hir","sessionID":"ses_4d6c125baffe3wHTNInEmsOJ7Q","messageID":"msg_b293edaae001q0udHeP63Aeoji","type":"tool","callID":"01KCMKXPNTE097TER81QD4V0HM","tool":"bash","state":{"status":"completed","input":{"command":"ls -la -- '/work/packages/opencode/src/server/'"},"output":"total 100\ndrwxrwxrwx  2 root root  4096 Dec 16 16:57 .\ndrwxrwxrwx 34 root root  4096 Dec 16 16:57 ..\n-rwxrwxrwx  1 root root   875 Dec 16 16:57 error.ts\n-rwxrwxrwx  1 root root  2272 Dec 16 16:57 project.ts\n-rwxrwxrwx  1 root root 79064 Dec 16 16:57 server.ts\n-rwxrwxrwx  1 root root  1828 Dec 16 16:57 tui.ts\n","title":"","metadata":{"output":"total 100\ndrwxrwxrwx  2 root root  4096 Dec 16 16:57 .\ndrwxrwxrwx 34 root root  4096 Dec 16 16:57 ..\n-rwxrwxrwx  1 root root   875 Dec 16 16:57 error.ts\n-rwxrwxrwx  1 root root  2272 Dec 16 16:57 project.ts\n-rwxrwxrwx  1 root root 79064 Dec 16 16:57 server.ts\n-rwxrwxrwx  1 root root  1828 Dec 16 16:57 tui.ts\n","description":""},"time":{"start":1765923543738,"end":1765923543841}}}}}

data: {"type":"session.status","properties":{"sessionID":"ses_4d6c125baffe3wHTNInEmsOJ7Q","status":{"type":"idle"}}}

data: {"type":"session.idle","properties":{"sessionID":"ses_4d6c125baffe3wHTNInEmsOJ7Q"}}

data: {"type":"session.created","properties":{"info":{"id":"ses_4d6c1243bffexKzICT2rW9HMcj","version":"local","projectID":"global","directory":"/work","title":"New session - 2025-12-16T22:19:04.005Z","time":{"created":1765923544005,"updated":1765923544005}}}}

data: {"type":"session.updated","properties":{"info":{"id":"ses_4d6c1243bffexKzICT2rW9HMcj","version":"local","projectID":"global","directory":"/work","title":"New session - 2025-12-16T22:19:04.005Z","time":{"created":1765923544005,"updated":1765923544005}}}}

data: {"type":"session.created","properties":{"info":{"id":"ses_4d6c123b4ffeWXwRVzzI2wohYB","version":"local","projectID":"global","directory":"/work","title":"New session - 2025-12-16T22:19:04.139Z","time":{"created":1765923544139,"updated":1765923544139}}}}

data: {"type":"session.updated","properties":{"info":{"id":"ses_4d6c123b4ffeWXwRVzzI2wohYB","version":"local","projectID":"global","directory":"/work","title":"New session - 2025-12-16T22:19:04.139Z","time":{"created":1765923544139,"updated":1765923544139}}}}

data: {"type":"message.updated","properties":{"info":{"id":"msg_b293edc64001EKq5cQH26aXQkN","sessionID":"ses_4d6c1243bffexKzICT2rW9HMcj","role":"user","time":{"created":1765923544164},"agent":"general","model":{"providerID":"opencode","modelID":"big-pickle"}}}}

data: {"type":"message.part.updated","properties":{"part":{"id":"prt_b293edc6d001GmXnEFlx3bjnCC","sessionID":"ses_4d6c1243bffexKzICT2rW9HMcj","messageID":"msg_b293edc64001EKq5cQH26aXQkN","type":"text","text":"The following tool was executed by the user","synthetic":true}}}

data: {"type":"message.updated","properties":{"info":{"id":"msg_b293edc8e001VnLrlf8RcMpBLF","sessionID":"ses_4d6c1243bffexKzICT2rW9HMcj","role":"assistant","time":{"created":1765923544206},"parentID":"msg_b293edc64001EKq5cQH26aXQkN","modelID":"big-pickle","providerID":"opencode","mode":"general","agent":"general","path":{"cwd":"/work","root":"/work"},"cost":0,"tokens":{"input":0,"output":0,"reasoning":0,"cache":{"read":0,"write":0}}}}}

data: {"type":"message.part.updated","properties":{"part":{"id":"prt_b293edc95001mSvP2kgYIu3OK6","sessionID":"ses_4d6c1243bffexKzICT2rW9HMcj","messageID":"msg_b293edc8e001VnLrlf8RcMpBLF","type":"tool","callID":"01KCMKXQ4NQWSD74FKBS2FB9QA","tool":"bash","state":{"status":"running","input":{"command":"ls -la -- '/work/packages/opencode/src/server/'"},"time":{"start":1765923544213}}}}}

data: {"type":"message.updated","properties":{"info":{"id":"msg_b293edcb4001BLADmKwRaCgall","sessionID":"ses_4d6c123b4ffeWXwRVzzI2wohYB","role":"user","time":{"created":1765923544244},"agent":"general","model":{"providerID":"opencode","modelID":"big-pickle"}}}}

data: {"type":"message.part.updated","properties":{"part":{"id":"prt_b293edc95001mSvP2kgYIu3OK6","sessionID":"ses_4d6c1243bffexKzICT2rW9HMcj","messageID":"msg_b293edc8e001VnLrlf8RcMpBLF","type":"tool","callID":"01KCMKXQ4NQWSD74FKBS2FB9QA","tool":"bash","state":{"status":"running","input":{"command":"ls -la -- '/work/packages/opencode/src/server/'"},"metadata":{"output":"total 100\ndrwxrwxrwx  2 root root  4096 Dec 16 16:57 .\ndrwxrwxrwx 34 root root  4096 Dec 16 16:57 ..\n-rwxrwxrwx  1 root root   875 Dec 16 16:57 error.ts\n-rwxrwxrwx  1 root root  2272 Dec 16 16:57 project.ts\n-rwxrwxrwx  1 root root 79064 Dec 16 16:57 server.ts\n-rwxrwxrwx  1 root root  1828 Dec 16 16:57 tui.ts\n","description":""},"time":{"start":1765923544213}}}}}

data: {"type":"message.updated","properties":{"info":{"id":"msg_b293edc8e001VnLrlf8RcMpBLF","sessionID":"ses_4d6c1243bffexKzICT2rW9HMcj","role":"assistant","time":{"created":1765923544206,"completed":1765923544312},"parentID":"msg_b293edc64001EKq5cQH26aXQkN","modelID":"big-pickle","providerID":"opencode","mode":"general","agent":"general","path":{"cwd":"/work","root":"/work"},"cost":0,"tokens":{"input":0,"output":0,"reasoning":0,"cache":{"read":0,"write":0}}}}}

data: {"type":"message.part.updated","properties":{"part":{"id":"prt_b293edc95001mSvP2kgYIu3OK6","sessionID":"ses_4d6c1243bffexKzICT2rW9HMcj","messageID":"msg_b293edc8e001VnLrlf8RcMpBLF","type":"tool","callID":"01KCMKXQ4NQWSD74FKBS2FB9QA","tool":"bash","state":{"status":"completed","input":{"command":"ls -la -- '/work/packages/opencode/src/server/'"},"output":"total 100\ndrwxrwxrwx  2 root root  4096 Dec 16 16:57 .\ndrwxrwxrwx 34 root root  4096 Dec 16 16:57 ..\n-rwxrwxrwx  1 root root   875 Dec 16 16:57 error.ts\n-rwxrwxrwx  1 root root  2272 Dec 16 16:57 project.ts\n-rwxrwxrwx  1 root root 79064 Dec 16 16:57 server.ts\n-rwxrwxrwx  1 root root  1828 Dec 16 16:57 tui.ts\n","title":"","metadata":{"output":"total 100\ndrwxrwxrwx  2 root root  4096 Dec 16 16:57 .\ndrwxrwxrwx 34 root root  4096 Dec 16 16:57 ..\n-rwxrwxrwx  1 root root   875 Dec 16 16:57 error.ts\n-rwxrwxrwx  1 root root  2272 Dec 16 16:57 project.ts\n-rwxrwxrwx  1 root root 79064 Dec 16 16:57 server.ts\n-rwxrwxrwx  1 root root  1828 Dec 16 16:57 tui.ts\n","description":""},"time":{"start":1765923544213,"end":1765923544312}}}}}

data: {"type":"session.status","properties":{"sessionID":"ses_4d6c1243bffexKzICT2rW9HMcj","status":{"type":"idle"}}}

data: {"type":"session.idle","properties":{"sessionID":"ses_4d6c1243bffexKzICT2rW9HMcj"}}

data: {"type":"message.part.updated","properties":{"part":{"id":"prt_b293edcd5001iVDqKHqZmVRZRt","sessionID":"ses_4d6c123b4ffeWXwRVzzI2wohYB","messageID":"msg_b293edcb4001BLADmKwRaCgall","type":"text","text":"The following tool was executed by the user","synthetic":true}}}

data: {"type":"message.updated","properties":{"info":{"id":"msg_b293edd0b0016ZHcYaXh9gzya2","sessionID":"ses_4d6c123b4ffeWXwRVzzI2wohYB","role":"assistant","time":{"created":1765923544331},"parentID":"msg_b293edcb4001BLADmKwRaCgall","modelID":"big-pickle","providerID":"opencode","mode":"general","agent":"general","path":{"cwd":"/work","root":"/work"},"cost":0,"tokens":{"input":0,"output":0,"reasoning":0,"cache":{"read":0,"write":0}}}}}

data: {"type":"message.part.updated","properties":{"part":{"id":"prt_b293edd21001Dwkuact7lu7ixm","sessionID":"ses_4d6c123b4ffeWXwRVzzI2wohYB","messageID":"msg_b293edd0b0016ZHcYaXh9gzya2","type":"tool","callID":"01KCMKXQ91SPAA3ADCQR5ADTV4","tool":"bash","state":{"status":"running","input":{"command":"ls -la -- '/work/packages/opencode/src/server/'"},"time":{"start":1765923544353}}}}}

data: {"type":"message.part.updated","properties":{"part":{"id":"prt_b293edd21001Dwkuact7lu7ixm","sessionID":"ses_4d6c123b4ffeWXwRVzzI2wohYB","messageID":"msg_b293edd0b0016ZHcYaXh9gzya2","type":"tool","callID":"01KCMKXQ91SPAA3ADCQR5ADTV4","tool":"bash","state":{"status":"running","input":{"command":"ls -la -- '/work/packages/opencode/src/server/'"},"metadata":{"output":"total 100\ndrwxrwxrwx  2 root root  4096 Dec 16 16:57 .\ndrwxrwxrwx 34 root root  4096 Dec 16 16:57 ..\n-rwxrwxrwx  1 root root   875 Dec 16 16:57 error.ts\n-rwxrwxrwx  1 root root  2272 Dec 16 16:57 project.ts\n-rwxrwxrwx  1 root root 79064 Dec 16 16:57 server.ts\n-rwxrwxrwx  1 root root  1828 Dec 16 16:57 tui.ts\n","description":""},"time":{"start":1765923544353}}}}}

data: {"type":"message.updated","properties":{"info":{"id":"msg_b293edd0b0016ZHcYaXh9gzya2","sessionID":"ses_4d6c123b4ffeWXwRVzzI2wohYB","role":"assistant","time":{"created":1765923544331,"completed":1765923544435},"parentID":"msg_b293edcb4001BLADmKwRaCgall","modelID":"big-pickle","providerID":"opencode","mode":"general","agent":"general","path":{"cwd":"/work","root":"/work"},"cost":0,"tokens":{"input":0,"output":0,"reasoning":0,"cache":{"read":0,"write":0}}}}}

data: {"type":"message.part.updated","properties":{"part":{"id":"prt_b293edd21001Dwkuact7lu7ixm","sessionID":"ses_4d6c123b4ffeWXwRVzzI2wohYB","messageID":"msg_b293edd0b0016ZHcYaXh9gzya2","type":"tool","callID":"01KCMKXQ91SPAA3ADCQR5ADTV4","tool":"bash","state":{"status":"completed","input":{"command":"ls -la -- '/work/packages/opencode/src/server/'"},"output":"total 100\ndrwxrwxrwx  2 root root  4096 Dec 16 16:57 .\ndrwxrwxrwx 34 root root  4096 Dec 16 16:57 ..\n-rwxrwxrwx  1 root root   875 Dec 16 16:57 error.ts\n-rwxrwxrwx  1 root root  2272 Dec 16 16:57 project.ts\n-rwxrwxrwx  1 root root 79064 Dec 16 16:57 server.ts\n-rwxrwxrwx  1 root root  1828 Dec 16 16:57 tui.ts\n","title":"","metadata":{"output":"total 100\ndrwxrwxrwx  2 root root  4096 Dec 16 16:57 .\ndrwxrwxrwx 34 root root  4096 Dec 16 16:57 ..\n-rwxrwxrwx  1 root root   875 Dec 16 16:57 error.ts\n-rwxrwxrwx  1 root root  2272 Dec 16 16:57 project.ts\n-rwxrwxrwx  1 root root 79064 Dec 16 16:57 server.ts\n-rwxrwxrwx  1 root root  1828 Dec 16 16:57 tui.ts\n","description":""},"time":{"start":1765923544353,"end":1765923544435}}}}}

data: {"type":"session.status","properties":{"sessionID":"ses_4d6c123b4ffeWXwRVzzI2wohYB","status":{"type":"idle"}}}

data: {"type":"session.idle","properties":{"sessionID":"ses_4d6c123b4ffeWXwRVzzI2wohYB"}}

data: {"type":"session.created","properties":{"info":{"id":"ses_4d6bdb4a4ffeUwBMKBxUUaHIQW","version":"local","projectID":"global","directory":"/work","title":"New session - 2025-12-16T22:22:49.179Z","time":{"created":1765923769179,"updated":1765923769179}}}}

data: {"type":"session.updated","properties":{"info":{"id":"ses_4d6bdb4a4ffeUwBMKBxUUaHIQW","version":"local","projectID":"global","directory":"/work","title":"New session - 2025-12-16T22:22:49.179Z","time":{"created":1765923769179,"updated":1765923769179}}}}

data: {"type":"message.updated","properties":{"info":{"id":"msg_b29424bb4001jtu6N7ZJoxjtU6","sessionID":"ses_4d6bdb4a4ffeUwBMKBxUUaHIQW","role":"user","time":{"created":1765923769268},"agent":"general","model":{"providerID":"opencode","modelID":"big-pickle"}}}}

data: {"type":"message.part.updated","properties":{"part":{"id":"prt_b29424bf0001tvJA3148dT5nWX","sessionID":"ses_4d6bdb4a4ffeUwBMKBxUUaHIQW","messageID":"msg_b29424bb4001jtu6N7ZJoxjtU6","type":"text","text":"The following tool was executed by the user","synthetic":true}}}

data: {"type":"message.updated","properties":{"info":{"id":"msg_b29424c24001QXASRS8d7XAz9H","sessionID":"ses_4d6bdb4a4ffeUwBMKBxUUaHIQW","role":"assistant","time":{"created":1765923769381},"parentID":"msg_b29424bb4001jtu6N7ZJoxjtU6","modelID":"big-pickle","providerID":"opencode","mode":"general","agent":"general","path":{"cwd":"/work","root":"/work"},"cost":0,"tokens":{"input":0,"output":0,"reasoning":0,"cache":{"read":0,"write":0}}}}}

data: {"type":"message.part.updated","properties":{"part":{"id":"prt_b29424c3c001JivzKEytsZ0fEg","sessionID":"ses_4d6bdb4a4ffeUwBMKBxUUaHIQW","messageID":"msg_b29424c24001QXASRS8d7XAz9H","type":"tool","callID":"01KCMM4K1WB3Y0WMEQ502C1Q1Y","tool":"bash","state":{"status":"running","input":{"command":"head -c 4096 -- '/work/packages/opencode/src/server/server.ts'"},"time":{"start":1765923769404}}}}}

data: {"type":"message.part.updated","properties":{"part":{"id":"prt_b29424c3c001JivzKEytsZ0fEg","sessionID":"ses_4d6bdb4a4ffeUwBMKBxUUaHIQW","messageID":"msg_b29424c24001QXASRS8d7XAz9H","type":"tool","callID":"01KCMM4K1WB3Y0WMEQ502C1Q1Y","tool":"bash","state":{"status":"running","input":{"command":"head -c 4096 -- '/work/packages/opencode/src/server/server.ts'"},"metadata":{"output":"import { BusEvent } from \"@/bus/bus-event\"\r\nimport { Bus } from \"@/bus\"\r\nimport { GlobalBus } from \"@/bus/global\"\r\nimport { Log } from \"../util/log\"\r\nimport { describeRoute, generateSpecs, validator, resolver, openAPIRouteHandler } from \"hono-openapi\"\r\nimport { Hono } from \"hono\"\r\nimport { cors } from \"hono/cors\"\r\nimport { stream, streamSSE } from \"hono/streaming\"\r\nimport { proxy } from \"hono/proxy\"\r\nimport { Session } from \"../session\"\r\nimport z from \"zod\"\r\nimport { Provider } from \"../provider/provider\"\r\nimport { filter, mapValues, sortBy, pipe } from \"remeda\"\r\nimport { NamedError } from \"@opencode-ai/util/error\"\r\nimport { ModelsDev } from \"../provider/models\"\r\nimport { Ripgrep } from \"../file/ripgrep\"\r\nimport { Config } from \"../config/config\"\r\nimport { File } from \"../file\"\r\nimport { LSP } from \"../lsp\"\r\nimport { Format } from \"../format\"\r\nimport { MessageV2 } from \"../session/message-v2\"\r\nimport { TuiRoute } from \"./tui\"\r\nimport { Permission } from \"../permission\"\r\nimport { Instance } from \"../project/instance\"\r\nimport { Vcs } from \"../project/vcs\"\r\nimport { Agent } from \"../agent/agent\"\r\nimport { Auth } from \"../auth\"\r\nimport { Command } from \"../command\"\r\nimport { ProviderAuth } from \"../provider/auth\"\r\nimport { Global } from \"../global\"\r\nimport { ProjectRoute } from \"./project\"\r\nimport { ToolRegistry } from \"../tool/registry\"\r\nimport { zodToJsonSchema } from \"zod-to-json-schema\"\r\nimport { SessionPrompt } from \"../session/prompt\"\r\nimport { SessionCompaction } from \"../session/compaction\"\r\nimport { SessionRevert } from \"../session/revert\"\r\nimport { lazy } from \"../util/lazy\"\r\nimport { Todo } from \"../session/todo\"\r\nimport { InstanceBootstrap } from \"../project/bootstrap\"\r\nimport { MCP } from \"../mcp\"\r\nimport { Storage } from \"../storage/storage\"\r\nimport type { ContentfulStatusCode } from \"hono/utils/http-status\"\r\nimport { TuiEvent } from \"@/cli/cmd/tui/event\"\r\nimport { Snapshot } from \"@/snapshot\"\r\nimport { SessionSummary } from \"@/session/summary\"\r\nimport { SessionStatus } from \"@/session/status\"\r\nimport { upgradeWebSocket, websocket } from \"hono/bun\"\r\nimport { errors } from \"./error\"\r\nimport { Pty } from \"@/pty\"\r\n\r\n// @ts-ignore This global is needed to prevent ai-sdk from logging warnings to stdout https://github.com/vercel/ai/blob/2dc67e0ef538307f21368db32d5a12345d98831b/packages/ai/src/logger/log-warnings.ts#L85\r\nglobalThis.AI_SDK_LOG_WARNINGS = false\r\n\r\nexport namespace Server {\r\n  const log = Log.create({ service: \"server\" })\r\n\r\n  export const Event = {\r\n    Connected: BusEvent.define(\"server.connected\", z.object({})),\r\n    Disposed: BusEvent.define(\"global.disposed\", z.object({})),\r\n  }\r\n\r\n  const app = new Hono()\r\n  export const App = lazy(() =>\r\n    app\r\n      .onError((err, c) => {\r\n        log.error(\"failed\", {\r\n          error: err,\r\n        })\r\n        if (err instanceof NamedError) {\r\n          let status: ContentfulStatusCode\r\n          if (err instanceof Storage.NotFoundError) status = 404\r\n          else if (err instanceof Provider.ModelNotFoundError) status = 400\r\n          else status = 500\r\n          return c.json(err.toObject(), { status })\r\n        }\r\n        const message = err instanceof Error && err.stack ? err.stack : err.toString()\r\n        return c.json(new NamedError.Unknown({ message }).toObject(), {\r\n          status: 500,\r\n        })\r\n      })\r\n      .use(async (c, next) => {\r\n        const skipLogging = c.req.path === \"/log\"\r\n        if (!skipLogging) {\r\n          log.info(\"request\", {\r\n            method: c.req.method,\r\n            path: c.req.path,\r\n          })\r\n        }\r\n        const timer = log.time(\"request\", {\r\n          method: c.req.method,\r\n          path: c.req.path,\r\n        })\r\n        await next()\r\n        if (!skipLogging) {\r\n          timer.stop()\r\n        }\r\n      })\r\n      .use(cors())\r\n      .get(\r\n        \"/global/event\",\r\n        describeRoute({\r\n          summary: \"Get global events\",\r\n          description: \"Subscribe to global events from the OpenCode system using server-sent events.\",\r\n          operationId: \"global.event\",\r\n          responses: {\r\n      ","description":""},"time":{"start":1765923769404}}}}}

data: {"type":"message.updated","properties":{"info":{"id":"msg_b29424c24001QXASRS8d7XAz9H","sessionID":"ses_4d6bdb4a4ffeUwBMKBxUUaHIQW","role":"assistant","time":{"created":1765923769381,"completed":1765923769576},"parentID":"msg_b29424bb4001jtu6N7ZJoxjtU6","modelID":"big-pickle","providerID":"opencode","mode":"general","agent":"general","path":{"cwd":"/work","root":"/work"},"cost":0,"tokens":{"input":0,"output":0,"reasoning":0,"cache":{"read":0,"write":0}}}}}

data: {"type":"message.part.updated","properties":{"part":{"id":"prt_b29424c3c001JivzKEytsZ0fEg","sessionID":"ses_4d6bdb4a4ffeUwBMKBxUUaHIQW","messageID":"msg_b29424c24001QXASRS8d7XAz9H","type":"tool","callID":"01KCMM4K1WB3Y0WMEQ502C1Q1Y","tool":"bash","state":{"status":"completed","input":{"command":"head -c 4096 -- '/work/packages/opencode/src/server/server.ts'"},"output":"import { BusEvent } from \"@/bus/bus-event\"\r\nimport { Bus } from \"@/bus\"\r\nimport { GlobalBus } from \"@/bus/global\"\r\nimport { Log } from \"../util/log\"\r\nimport { describeRoute, generateSpecs, validator, resolver, openAPIRouteHandler } from \"hono-openapi\"\r\nimport { Hono } from \"hono\"\r\nimport { cors } from \"hono/cors\"\r\nimport { stream, streamSSE } from \"hono/streaming\"\r\nimport { proxy } from \"hono/proxy\"\r\nimport { Session } from \"../session\"\r\nimport z from \"zod\"\r\nimport { Provider } from \"../provider/provider\"\r\nimport { filter, mapValues, sortBy, pipe } from \"remeda\"\r\nimport { NamedError } from \"@opencode-ai/util/error\"\r\nimport { ModelsDev } from \"../provider/models\"\r\nimport { Ripgrep } from \"../file/ripgrep\"\r\nimport { Config } from \"../config/config\"\r\nimport { File } from \"../file\"\r\nimport { LSP } from \"../lsp\"\r\nimport { Format } from \"../format\"\r\nimport { MessageV2 } from \"../session/message-v2\"\r\nimport { TuiRoute } from \"./tui\"\r\nimport { Permission } from \"../permission\"\r\nimport { Instance } from \"../project/instance\"\r\nimport { Vcs } from \"../project/vcs\"\r\nimport { Agent } from \"../agent/agent\"\r\nimport { Auth } from \"../auth\"\r\nimport { Command } from \"../command\"\r\nimport { ProviderAuth } from \"../provider/auth\"\r\nimport { Global } from \"../global\"\r\nimport { ProjectRoute } from \"./project\"\r\nimport { ToolRegistry } from \"../tool/registry\"\r\nimport { zodToJsonSchema } from \"zod-to-json-schema\"\r\nimport { SessionPrompt } from \"../session/prompt\"\r\nimport { SessionCompaction } from \"../session/compaction\"\r\nimport { SessionRevert } from \"../session/revert\"\r\nimport { lazy } from \"../util/lazy\"\r\nimport { Todo } from \"../session/todo\"\r\nimport { InstanceBootstrap } from \"../project/bootstrap\"\r\nimport { MCP } from \"../mcp\"\r\nimport { Storage } from \"../storage/storage\"\r\nimport type { ContentfulStatusCode } from \"hono/utils/http-status\"\r\nimport { TuiEvent } from \"@/cli/cmd/tui/event\"\r\nimport { Snapshot } from \"@/snapshot\"\r\nimport { SessionSummary } from \"@/session/summary\"\r\nimport { SessionStatus } from \"@/session/status\"\r\nimport { upgradeWebSocket, websocket } from \"hono/bun\"\r\nimport { errors } from \"./error\"\r\nimport { Pty } from \"@/pty\"\r\n\r\n// @ts-ignore This global is needed to prevent ai-sdk from logging warnings to stdout https://github.com/vercel/ai/blob/2dc67e0ef538307f21368db32d5a12345d98831b/packages/ai/src/logger/log-warnings.ts#L85\r\nglobalThis.AI_SDK_LOG_WARNINGS = false\r\n\r\nexport namespace Server {\r\n  const log = Log.create({ service: \"server\" })\r\n\r\n  export const Event = {\r\n    Connected: BusEvent.define(\"server.connected\", z.object({})),\r\n    Disposed: BusEvent.define(\"global.disposed\", z.object({})),\r\n  }\r\n\r\n  const app = new Hono()\r\n  export const App = lazy(() =>\r\n    app\r\n      .onError((err, c) => {\r\n        log.error(\"failed\", {\r\n          error: err,\r\n        })\r\n        if (err instanceof NamedError) {\r\n          let status: ContentfulStatusCode\r\n          if (err instanceof Storage.NotFoundError) status = 404\r\n          else if (err instanceof Provider.ModelNotFoundError) status = 400\r\n          else status = 500\r\n          return c.json(err.toObject(), { status })\r\n        }\r\n        const message = err instanceof Error && err.stack ? err.stack : err.toString()\r\n        return c.json(new NamedError.Unknown({ message }).toObject(), {\r\n          status: 500,\r\n        })\r\n      })\r\n      .use(async (c, next) => {\r\n        const skipLogging = c.req.path === \"/log\"\r\n        if (!skipLogging) {\r\n          log.info(\"request\", {\r\n            method: c.req.method,\r\n            path: c.req.path,\r\n          })\r\n        }\r\n        const timer = log.time(\"request\", {\r\n          method: c.req.method,\r\n          path: c.req.path,\r\n        })\r\n        await next()\r\n        if (!skipLogging) {\r\n          timer.stop()\r\n        }\r\n      })\r\n      .use(cors())\r\n      .get(\r\n        \"/global/event\",\r\n        describeRoute({\r\n          summary: \"Get global events\",\r\n          description: \"Subscribe to global events from the OpenCode system using server-sent events.\",\r\n          operationId: \"global.event\",\r\n          responses: {\r\n      ","title":"","metadata":{"output":"import { BusEvent } from \"@/bus/bus-event\"\r\nimport { Bus } from \"@/bus\"\r\nimport { GlobalBus } from \"@/bus/global\"\r\nimport { Log } from \"../util/log\"\r\nimport { describeRoute, generateSpecs, validator, resolver, openAPIRouteHandler } from \"hono-openapi\"\r\nimport { Hono } from \"hono\"\r\nimport { cors } from \"hono/cors\"\r\nimport { stream, streamSSE } from \"hono/streaming\"\r\nimport { proxy } from \"hono/proxy\"\r\nimport { Session } from \"../session\"\r\nimport z from \"zod\"\r\nimport { Provider } from \"../provider/provider\"\r\nimport { filter, mapValues, sortBy, pipe } from \"remeda\"\r\nimport { NamedError } from \"@opencode-ai/util/error\"\r\nimport { ModelsDev } from \"../provider/models\"\r\nimport { Ripgrep } from \"../file/ripgrep\"\r\nimport { Config } from \"../config/config\"\r\nimport { File } from \"../file\"\r\nimport { LSP } from \"../lsp\"\r\nimport { Format } from \"../format\"\r\nimport { MessageV2 } from \"../session/message-v2\"\r\nimport { TuiRoute } from \"./tui\"\r\nimport { Permission } from \"../permission\"\r\nimport { Instance } from \"../project/instance\"\r\nimport { Vcs } from \"../project/vcs\"\r\nimport { Agent } from \"../agent/agent\"\r\nimport { Auth } from \"../auth\"\r\nimport { Command } from \"../command\"\r\nimport { ProviderAuth } from \"../provider/auth\"\r\nimport { Global } from \"../global\"\r\nimport { ProjectRoute } from \"./project\"\r\nimport { ToolRegistry } from \"../tool/registry\"\r\nimport { zodToJsonSchema } from \"zod-to-json-schema\"\r\nimport { SessionPrompt } from \"../session/prompt\"\r\nimport { SessionCompaction } from \"../session/compaction\"\r\nimport { SessionRevert } from \"../session/revert\"\r\nimport { lazy } from \"../util/lazy\"\r\nimport { Todo } from \"../session/todo\"\r\nimport { InstanceBootstrap } from \"../project/bootstrap\"\r\nimport { MCP } from \"../mcp\"\r\nimport { Storage } from \"../storage/storage\"\r\nimport type { ContentfulStatusCode } from \"hono/utils/http-status\"\r\nimport { TuiEvent } from \"@/cli/cmd/tui/event\"\r\nimport { Snapshot } from \"@/snapshot\"\r\nimport { SessionSummary } from \"@/session/summary\"\r\nimport { SessionStatus } from \"@/session/status\"\r\nimport { upgradeWebSocket, websocket } from \"hono/bun\"\r\nimport { errors } from \"./error\"\r\nimport { Pty } from \"@/pty\"\r\n\r\n// @ts-ignore This global is needed to prevent ai-sdk from logging warnings to stdout https://github.com/vercel/ai/blob/2dc67e0ef538307f21368db32d5a12345d98831b/packages/ai/src/logger/log-warnings.ts#L85\r\nglobalThis.AI_SDK_LOG_WARNINGS = false\r\n\r\nexport namespace Server {\r\n  const log = Log.create({ service: \"server\" })\r\n\r\n  export const Event = {\r\n    Connected: BusEvent.define(\"server.connected\", z.object({})),\r\n    Disposed: BusEvent.define(\"global.disposed\", z.object({})),\r\n  }\r\n\r\n  const app = new Hono()\r\n  export const App = lazy(() =>\r\n    app\r\n      .onError((err, c) => {\r\n        log.error(\"failed\", {\r\n          error: err,\r\n        })\r\n        if (err instanceof NamedError) {\r\n          let status: ContentfulStatusCode\r\n          if (err instanceof Storage.NotFoundError) status = 404\r\n          else if (err instanceof Provider.ModelNotFoundError) status = 400\r\n          else status = 500\r\n          return c.json(err.toObject(), { status })\r\n        }\r\n        const message = err instanceof Error && err.stack ? err.stack : err.toString()\r\n        return c.json(new NamedError.Unknown({ message }).toObject(), {\r\n          status: 500,\r\n        })\r\n      })\r\n      .use(async (c, next) => {\r\n        const skipLogging = c.req.path === \"/log\"\r\n        if (!skipLogging) {\r\n          log.info(\"request\", {\r\n            method: c.req.method,\r\n            path: c.req.path,\r\n          })\r\n        }\r\n        const timer = log.time(\"request\", {\r\n          method: c.req.method,\r\n          path: c.req.path,\r\n        })\r\n        await next()\r\n        if (!skipLogging) {\r\n          timer.stop()\r\n        }\r\n      })\r\n      .use(cors())\r\n      .get(\r\n        \"/global/event\",\r\n        describeRoute({\r\n          summary: \"Get global events\",\r\n          description: \"Subscribe to global events from the OpenCode system using server-sent events.\",\r\n          operationId: \"global.event\",\r\n          responses: {\r\n      ","description":""},"time":{"start":1765923769404,"end":1765923769577}}}}}

data: {"type":"session.status","properties":{"sessionID":"ses_4d6bdb4a4ffeUwBMKBxUUaHIQW","status":{"type":"idle"}}}

data: {"type":"session.idle","properties":{"sessionID":"ses_4d6bdb4a4ffeUwBMKBxUUaHIQW"}}

data: {"type":"session.created","properties":{"info":{"id":"ses_4d6bcea14ffepX5xxr50x0z6vC","version":"local","projectID":"global","directory":"/work","title":"New session - 2025-12-16T22:23:41.035Z","time":{"created":1765923821035,"updated":1765923821035}}}}

data: {"type":"session.updated","properties":{"info":{"id":"ses_4d6bcea14ffepX5xxr50x0z6vC","version":"local","projectID":"global","directory":"/work","title":"New session - 2025-12-16T22:23:41.035Z","time":{"created":1765923821035,"updated":1765923821035}}}}

data: {"type":"message.updated","properties":{"info":{"id":"msg_b2943160d0012pV1uP8zZBh0Xm","sessionID":"ses_4d6bcea14ffepX5xxr50x0z6vC","role":"user","time":{"created":1765923821069},"agent":"general","model":{"providerID":"opencode","modelID":"big-pickle"}}}}

data: {"type":"message.part.updated","properties":{"part":{"id":"prt_b2943161d001YqOAqTba7b4w5X","sessionID":"ses_4d6bcea14ffepX5xxr50x0z6vC","messageID":"msg_b2943160d0012pV1uP8zZBh0Xm","type":"text","text":"The following tool was executed by the user","synthetic":true}}}

data: {"type":"message.updated","properties":{"info":{"id":"msg_b2943162d00167Mn0hu7GwiF2E","sessionID":"ses_4d6bcea14ffepX5xxr50x0z6vC","role":"assistant","time":{"created":1765923821102},"parentID":"msg_b2943160d0012pV1uP8zZBh0Xm","modelID":"big-pickle","providerID":"opencode","mode":"general","agent":"general","path":{"cwd":"/work","root":"/work"},"cost":0,"tokens":{"input":0,"output":0,"reasoning":0,"cache":{"read":0,"write":0}}}}}

data: {"type":"message.part.updated","properties":{"part":{"id":"prt_b29431633001TZgC7UPmCPLhe6","sessionID":"ses_4d6bcea14ffepX5xxr50x0z6vC","messageID":"msg_b2943162d00167Mn0hu7GwiF2E","type":"tool","callID":"01KCMM65HK3HGGFEMG9W6QJSRJ","tool":"bash","state":{"status":"running","input":{"command":"head -c 4096 -- '/work/packages/opencode/src/server/server.ts'"},"time":{"start":1765923821107}}}}}

data: {"type":"message.part.updated","properties":{"part":{"id":"prt_b29431633001TZgC7UPmCPLhe6","sessionID":"ses_4d6bcea14ffepX5xxr50x0z6vC","messageID":"msg_b2943162d00167Mn0hu7GwiF2E","type":"tool","callID":"01KCMM65HK3HGGFEMG9W6QJSRJ","tool":"bash","state":{"status":"running","input":{"command":"head -c 4096 -- '/work/packages/opencode/src/server/server.ts'"},"metadata":{"output":"import { BusEvent } from \"@/bus/bus-event\"\r\nimport { Bus } from \"@/bus\"\r\nimport { GlobalBus } from \"@/bus/global\"\r\nimport { Log } from \"../util/log\"\r\nimport { describeRoute, generateSpecs, validator, resolver, openAPIRouteHandler } from \"hono-openapi\"\r\nimport { Hono } from \"hono\"\r\nimport { cors } from \"hono/cors\"\r\nimport { stream, streamSSE } from \"hono/streaming\"\r\nimport { proxy } from \"hono/proxy\"\r\nimport { Session } from \"../session\"\r\nimport z from \"zod\"\r\nimport { Provider } from \"../provider/provider\"\r\nimport { filter, mapValues, sortBy, pipe } from \"remeda\"\r\nimport { NamedError } from \"@opencode-ai/util/error\"\r\nimport { ModelsDev } from \"../provider/models\"\r\nimport { Ripgrep } from \"../file/ripgrep\"\r\nimport { Config } from \"../config/config\"\r\nimport { File } from \"../file\"\r\nimport { LSP } from \"../lsp\"\r\nimport { Format } from \"../format\"\r\nimport { MessageV2 } from \"../session/message-v2\"\r\nimport { TuiRoute } from \"./tui\"\r\nimport { Permission } from \"../permission\"\r\nimport { Instance } from \"../project/instance\"\r\nimport { Vcs } from \"../project/vcs\"\r\nimport { Agent } from \"../agent/agent\"\r\nimport { Auth } from \"../auth\"\r\nimport { Command } from \"../command\"\r\nimport { ProviderAuth } from \"../provider/auth\"\r\nimport { Global } from \"../global\"\r\nimport { ProjectRoute } from \"./project\"\r\nimport { ToolRegistry } from \"../tool/registry\"\r\nimport { zodToJsonSchema } from \"zod-to-json-schema\"\r\nimport { SessionPrompt } from \"../session/prompt\"\r\nimport { SessionCompaction } from \"../session/compaction\"\r\nimport { SessionRevert } from \"../session/revert\"\r\nimport { lazy } from \"../util/lazy\"\r\nimport { Todo } from \"../session/todo\"\r\nimport { InstanceBootstrap } from \"../project/bootstrap\"\r\nimport { MCP } from \"../mcp\"\r\nimport { Storage } from \"../storage/storage\"\r\nimport type { ContentfulStatusCode } from \"hono/utils/http-status\"\r\nimport { TuiEvent } from \"@/cli/cmd/tui/event\"\r\nimport { Snapshot } from \"@/snapshot\"\r\nimport { SessionSummary } from \"@/session/summary\"\r\nimport { SessionStatus } from \"@/session/status\"\r\nimport { upgradeWebSocket, websocket } from \"hono/bun\"\r\nimport { errors } from \"./error\"\r\nimport { Pty } from \"@/pty\"\r\n\r\n// @ts-ignore This global is needed to prevent ai-sdk from logging warnings to stdout https://github.com/vercel/ai/blob/2dc67e0ef538307f21368db32d5a12345d98831b/packages/ai/src/logger/log-warnings.ts#L85\r\nglobalThis.AI_SDK_LOG_WARNINGS = false\r\n\r\nexport namespace Server {\r\n  const log = Log.create({ service: \"server\" })\r\n\r\n  export const Event = {\r\n    Connected: BusEvent.define(\"server.connected\", z.object({})),\r\n    Disposed: BusEvent.define(\"global.disposed\", z.object({})),\r\n  }\r\n\r\n  const app = new Hono()\r\n  export const App = lazy(() =>\r\n    app\r\n      .onError((err, c) => {\r\n        log.error(\"failed\", {\r\n          error: err,\r\n        })\r\n        if (err instanceof NamedError) {\r\n          let status: ContentfulStatusCode\r\n          if (err instanceof Storage.NotFoundError) status = 404\r\n          else if (err instanceof Provider.ModelNotFoundError) status = 400\r\n          else status = 500\r\n          return c.json(err.toObject(), { status })\r\n        }\r\n        const message = err instanceof Error && err.stack ? err.stack : err.toString()\r\n        return c.json(new NamedError.Unknown({ message }).toObject(), {\r\n          status: 500,\r\n        })\r\n      })\r\n      .use(async (c, next) => {\r\n        const skipLogging = c.req.path === \"/log\"\r\n        if (!skipLogging) {\r\n          log.info(\"request\", {\r\n            method: c.req.method,\r\n            path: c.req.path,\r\n          })\r\n        }\r\n        const timer = log.time(\"request\", {\r\n          method: c.req.method,\r\n          path: c.req.path,\r\n        })\r\n        await next()\r\n        if (!skipLogging) {\r\n          timer.stop()\r\n        }\r\n      })\r\n      .use(cors())\r\n      .get(\r\n        \"/global/event\",\r\n        describeRoute({\r\n          summary: \"Get global events\",\r\n          description: \"Subscribe to global events from the OpenCode system using server-sent events.\",\r\n          operationId: \"global.event\",\r\n          responses: {\r\n      ","description":""},"time":{"start":1765923821107}}}}}

data: {"type":"message.updated","properties":{"info":{"id":"msg_b2943162d00167Mn0hu7GwiF2E","sessionID":"ses_4d6bcea14ffepX5xxr50x0z6vC","role":"assistant","time":{"created":1765923821102,"completed":1765923821163},"parentID":"msg_b2943160d0012pV1uP8zZBh0Xm","modelID":"big-pickle","providerID":"opencode","mode":"general","agent":"general","path":{"cwd":"/work","root":"/work"},"cost":0,"tokens":{"input":0,"output":0,"reasoning":0,"cache":{"read":0,"write":0}}}}}

data: {"type":"message.part.updated","properties":{"part":{"id":"prt_b29431633001TZgC7UPmCPLhe6","sessionID":"ses_4d6bcea14ffepX5xxr50x0z6vC","messageID":"msg_b2943162d00167Mn0hu7GwiF2E","type":"tool","callID":"01KCMM65HK3HGGFEMG9W6QJSRJ","tool":"bash","state":{"status":"completed","input":{"command":"head -c 4096 -- '/work/packages/opencode/src/server/server.ts'"},"output":"import { BusEvent } from \"@/bus/bus-event\"\r\nimport { Bus } from \"@/bus\"\r\nimport { GlobalBus } from \"@/bus/global\"\r\nimport { Log } from \"../util/log\"\r\nimport { describeRoute, generateSpecs, validator, resolver, openAPIRouteHandler } from \"hono-openapi\"\r\nimport { Hono } from \"hono\"\r\nimport { cors } from \"hono/cors\"\r\nimport { stream, streamSSE } from \"hono/streaming\"\r\nimport { proxy } from \"hono/proxy\"\r\nimport { Session } from \"../session\"\r\nimport z from \"zod\"\r\nimport { Provider } from \"../provider/provider\"\r\nimport { filter, mapValues, sortBy, pipe } from \"remeda\"\r\nimport { NamedError } from \"@opencode-ai/util/error\"\r\nimport { ModelsDev } from \"../provider/models\"\r\nimport { Ripgrep } from \"../file/ripgrep\"\r\nimport { Config } from \"../config/config\"\r\nimport { File } from \"../file\"\r\nimport { LSP } from \"../lsp\"\r\nimport { Format } from \"../format\"\r\nimport { MessageV2 } from \"../session/message-v2\"\r\nimport { TuiRoute } from \"./tui\"\r\nimport { Permission } from \"../permission\"\r\nimport { Instance } from \"../project/instance\"\r\nimport { Vcs } from \"../project/vcs\"\r\nimport { Agent } from \"../agent/agent\"\r\nimport { Auth } from \"../auth\"\r\nimport { Command } from \"../command\"\r\nimport { ProviderAuth } from \"../provider/auth\"\r\nimport { Global } from \"../global\"\r\nimport { ProjectRoute } from \"./project\"\r\nimport { ToolRegistry } from \"../tool/registry\"\r\nimport { zodToJsonSchema } from \"zod-to-json-schema\"\r\nimport { SessionPrompt } from \"../session/prompt\"\r\nimport { SessionCompaction } from \"../session/compaction\"\r\nimport { SessionRevert } from \"../session/revert\"\r\nimport { lazy } from \"../util/lazy\"\r\nimport { Todo } from \"../session/todo\"\r\nimport { InstanceBootstrap } from \"../project/bootstrap\"\r\nimport { MCP } from \"../mcp\"\r\nimport { Storage } from \"../storage/storage\"\r\nimport type { ContentfulStatusCode } from \"hono/utils/http-status\"\r\nimport { TuiEvent } from \"@/cli/cmd/tui/event\"\r\nimport { Snapshot } from \"@/snapshot\"\r\nimport { SessionSummary } from \"@/session/summary\"\r\nimport { SessionStatus } from \"@/session/status\"\r\nimport { upgradeWebSocket, websocket } from \"hono/bun\"\r\nimport { errors } from \"./error\"\r\nimport { Pty } from \"@/pty\"\r\n\r\n// @ts-ignore This global is needed to prevent ai-sdk from logging warnings to stdout https://github.com/vercel/ai/blob/2dc67e0ef538307f21368db32d5a12345d98831b/packages/ai/src/logger/log-warnings.ts#L85\r\nglobalThis.AI_SDK_LOG_WARNINGS = false\r\n\r\nexport namespace Server {\r\n  const log = Log.create({ service: \"server\" })\r\n\r\n  export const Event = {\r\n    Connected: BusEvent.define(\"server.connected\", z.object({})),\r\n    Disposed: BusEvent.define(\"global.disposed\", z.object({})),\r\n  }\r\n\r\n  const app = new Hono()\r\n  export const App = lazy(() =>\r\n    app\r\n      .onError((err, c) => {\r\n        log.error(\"failed\", {\r\n          error: err,\r\n        })\r\n        if (err instanceof NamedError) {\r\n          let status: ContentfulStatusCode\r\n          if (err instanceof Storage.NotFoundError) status = 404\r\n          else if (err instanceof Provider.ModelNotFoundError) status = 400\r\n          else status = 500\r\n          return c.json(err.toObject(), { status })\r\n        }\r\n        const message = err instanceof Error && err.stack ? err.stack : err.toString()\r\n        return c.json(new NamedError.Unknown({ message }).toObject(), {\r\n          status: 500,\r\n        })\r\n      })\r\n      .use(async (c, next) => {\r\n        const skipLogging = c.req.path === \"/log\"\r\n        if (!skipLogging) {\r\n          log.info(\"request\", {\r\n            method: c.req.method,\r\n            path: c.req.path,\r\n          })\r\n        }\r\n        const timer = log.time(\"request\", {\r\n          method: c.req.method,\r\n          path: c.req.path,\r\n        })\r\n        await next()\r\n        if (!skipLogging) {\r\n          timer.stop()\r\n        }\r\n      })\r\n      .use(cors())\r\n      .get(\r\n        \"/global/event\",\r\n        describeRoute({\r\n          summary: \"Get global events\",\r\n          description: \"Subscribe to global events from the OpenCode system using server-sent events.\",\r\n          operationId: \"global.event\",\r\n          responses: {\r\n      ","title":"","metadata":{"output":"import { BusEvent } from \"@/bus/bus-event\"\r\nimport { Bus } from \"@/bus\"\r\nimport { GlobalBus } from \"@/bus/global\"\r\nimport { Log } from \"../util/log\"\r\nimport { describeRoute, generateSpecs, validator, resolver, openAPIRouteHandler } from \"hono-openapi\"\r\nimport { Hono } from \"hono\"\r\nimport { cors } from \"hono/cors\"\r\nimport { stream, streamSSE } from \"hono/streaming\"\r\nimport { proxy } from \"hono/proxy\"\r\nimport { Session } from \"../session\"\r\nimport z from \"zod\"\r\nimport { Provider } from \"../provider/provider\"\r\nimport { filter, mapValues, sortBy, pipe } from \"remeda\"\r\nimport { NamedError } from \"@opencode-ai/util/error\"\r\nimport { ModelsDev } from \"../provider/models\"\r\nimport { Ripgrep } from \"../file/ripgrep\"\r\nimport { Config } from \"../config/config\"\r\nimport { File } from \"../file\"\r\nimport { LSP } from \"../lsp\"\r\nimport { Format } from \"../format\"\r\nimport { MessageV2 } from \"../session/message-v2\"\r\nimport { TuiRoute } from \"./tui\"\r\nimport { Permission } from \"../permission\"\r\nimport { Instance } from \"../project/instance\"\r\nimport { Vcs } from \"../project/vcs\"\r\nimport { Agent } from \"../agent/agent\"\r\nimport { Auth } from \"../auth\"\r\nimport { Command } from \"../command\"\r\nimport { ProviderAuth } from \"../provider/auth\"\r\nimport { Global } from \"../global\"\r\nimport { ProjectRoute } from \"./project\"\r\nimport { ToolRegistry } from \"../tool/registry\"\r\nimport { zodToJsonSchema } from \"zod-to-json-schema\"\r\nimport { SessionPrompt } from \"../session/prompt\"\r\nimport { SessionCompaction } from \"../session/compaction\"\r\nimport { SessionRevert } from \"../session/revert\"\r\nimport { lazy } from \"../util/lazy\"\r\nimport { Todo } from \"../session/todo\"\r\nimport { InstanceBootstrap } from \"../project/bootstrap\"\r\nimport { MCP } from \"../mcp\"\r\nimport { Storage } from \"../storage/storage\"\r\nimport type { ContentfulStatusCode } from \"hono/utils/http-status\"\r\nimport { TuiEvent } from \"@/cli/cmd/tui/event\"\r\nimport { Snapshot } from \"@/snapshot\"\r\nimport { SessionSummary } from \"@/session/summary\"\r\nimport { SessionStatus } from \"@/session/status\"\r\nimport { upgradeWebSocket, websocket } from \"hono/bun\"\r\nimport { errors } from \"./error\"\r\nimport { Pty } from \"@/pty\"\r\n\r\n// @ts-ignore This global is needed to prevent ai-sdk from logging warnings to stdout https://github.com/vercel/ai/blob/2dc67e0ef538307f21368db32d5a12345d98831b/packages/ai/src/logger/log-warnings.ts#L85\r\nglobalThis.AI_SDK_LOG_WARNINGS = false\r\n\r\nexport namespace Server {\r\n  const log = Log.create({ service: \"server\" })\r\n\r\n  export const Event = {\r\n    Connected: BusEvent.define(\"server.connected\", z.object({})),\r\n    Disposed: BusEvent.define(\"global.disposed\", z.object({})),\r\n  }\r\n\r\n  const app = new Hono()\r\n  export const App = lazy(() =>\r\n    app\r\n      .onError((err, c) => {\r\n        log.error(\"failed\", {\r\n          error: err,\r\n        })\r\n        if (err instanceof NamedError) {\r\n          let status: ContentfulStatusCode\r\n          if (err instanceof Storage.NotFoundError) status = 404\r\n          else if (err instanceof Provider.ModelNotFoundError) status = 400\r\n          else status = 500\r\n          return c.json(err.toObject(), { status })\r\n        }\r\n        const message = err instanceof Error && err.stack ? err.stack : err.toString()\r\n        return c.json(new NamedError.Unknown({ message }).toObject(), {\r\n          status: 500,\r\n        })\r\n      })\r\n      .use(async (c, next) => {\r\n        const skipLogging = c.req.path === \"/log\"\r\n        if (!skipLogging) {\r\n          log.info(\"request\", {\r\n            method: c.req.method,\r\n            path: c.req.path,\r\n          })\r\n        }\r\n        const timer = log.time(\"request\", {\r\n          method: c.req.method,\r\n          path: c.req.path,\r\n        })\r\n        await next()\r\n        if (!skipLogging) {\r\n          timer.stop()\r\n        }\r\n      })\r\n      .use(cors())\r\n      .get(\r\n        \"/global/event\",\r\n        describeRoute({\r\n          summary: \"Get global events\",\r\n          description: \"Subscribe to global events from the OpenCode system using server-sent events.\",\r\n          operationId: \"global.event\",\r\n          responses: {\r\n      ","description":""},"time":{"start":1765923821107,"end":1765923821164}}}}}

data: {"type":"session.status","properties":{"sessionID":"ses_4d6bcea14ffepX5xxr50x0z6vC","status":{"type":"idle"}}}

data: {"type":"session.idle","properties":{"sessionID":"ses_4d6bcea14ffepX5xxr50x0z6vC"}}

data: {"type":"session.created","properties":{"info":{"id":"ses_4d6bbb493ffe34xOEDKbcKWwTr","version":"local","projectID":"global","directory":"/work","title":"New session - 2025-12-16T22:25:00.269Z","time":{"created":1765923900269,"updated":1765923900269}}}}

data: {"type":"session.updated","properties":{"info":{"id":"ses_4d6bbb493ffe34xOEDKbcKWwTr","version":"local","projectID":"global","directory":"/work","title":"New session - 2025-12-16T22:25:00.269Z","time":{"created":1765923900269,"updated":1765923900269}}}}

data: {"type":"message.updated","properties":{"info":{"id":"msg_b29444b8c001yTVNO9Cg5ZhQ4t","sessionID":"ses_4d6bbb493ffe34xOEDKbcKWwTr","role":"user","time":{"created":1765923900300},"agent":"general","model":{"providerID":"opencode","modelID":"big-pickle"}}}}

data: {"type":"message.part.updated","properties":{"part":{"id":"prt_b29444b9300129oY2YrZMomDzc","sessionID":"ses_4d6bbb493ffe34xOEDKbcKWwTr","messageID":"msg_b29444b8c001yTVNO9Cg5ZhQ4t","type":"text","text":"The following tool was executed by the user","synthetic":true}}}

data: {"type":"message.updated","properties":{"info":{"id":"msg_b29444ba0001Qw1NYu2ZiH1ZyP","sessionID":"ses_4d6bbb493ffe34xOEDKbcKWwTr","role":"assistant","time":{"created":1765923900321},"parentID":"msg_b29444b8c001yTVNO9Cg5ZhQ4t","modelID":"big-pickle","providerID":"opencode","mode":"general","agent":"general","path":{"cwd":"/work","root":"/work"},"cost":0,"tokens":{"input":0,"output":0,"reasoning":0,"cache":{"read":0,"write":0}}}}}

data: {"type":"message.part.updated","properties":{"part":{"id":"prt_b29444bab001gzVNlD3h8OS3JO","sessionID":"ses_4d6bbb493ffe34xOEDKbcKWwTr","messageID":"msg_b29444ba0001Qw1NYu2ZiH1ZyP","type":"tool","callID":"01KCMM8JXCRV1XD74VAQ5WSAWR","tool":"bash","state":{"status":"running","input":{"command":"head -c 4096 -- '/work/packages/opencode/src/server/server.ts'"},"time":{"start":1765923900332}}}}}

data: {"type":"message.part.updated","properties":{"part":{"id":"prt_b29444bab001gzVNlD3h8OS3JO","sessionID":"ses_4d6bbb493ffe34xOEDKbcKWwTr","messageID":"msg_b29444ba0001Qw1NYu2ZiH1ZyP","type":"tool","callID":"01KCMM8JXCRV1XD74VAQ5WSAWR","tool":"bash","state":{"status":"running","input":{"command":"head -c 4096 -- '/work/packages/opencode/src/server/server.ts'"},"metadata":{"output":"import { BusEvent } from \"@/bus/bus-event\"\r\nimport { Bus } from \"@/bus\"\r\nimport { GlobalBus } from \"@/bus/global\"\r\nimport { Log } from \"../util/log\"\r\nimport { describeRoute, generateSpecs, validator, resolver, openAPIRouteHandler } from \"hono-openapi\"\r\nimport { Hono } from \"hono\"\r\nimport { cors } from \"hono/cors\"\r\nimport { stream, streamSSE } from \"hono/streaming\"\r\nimport { proxy } from \"hono/proxy\"\r\nimport { Session } from \"../session\"\r\nimport z from \"zod\"\r\nimport { Provider } from \"../provider/provider\"\r\nimport { filter, mapValues, sortBy, pipe } from \"remeda\"\r\nimport { NamedError } from \"@opencode-ai/util/error\"\r\nimport { ModelsDev } from \"../provider/models\"\r\nimport { Ripgrep } from \"../file/ripgrep\"\r\nimport { Config } from \"../config/config\"\r\nimport { File } from \"../file\"\r\nimport { LSP } from \"../lsp\"\r\nimport { Format } from \"../format\"\r\nimport { MessageV2 } from \"../session/message-v2\"\r\nimport { TuiRoute } from \"./tui\"\r\nimport { Permission } from \"../permission\"\r\nimport { Instance } from \"../project/instance\"\r\nimport { Vcs } from \"../project/vcs\"\r\nimport { Agent } from \"../agent/agent\"\r\nimport { Auth } from \"../auth\"\r\nimport { Command } from \"../command\"\r\nimport { ProviderAuth } from \"../provider/auth\"\r\nimport { Global } from \"../global\"\r\nimport { ProjectRoute } from \"./project\"\r\nimport { ToolRegistry } from \"../tool/registry\"\r\nimport { zodToJsonSchema } from \"zod-to-json-schema\"\r\nimport { SessionPrompt } from \"../session/prompt\"\r\nimport { SessionCompaction } from \"../session/compaction\"\r\nimport { SessionRevert } from \"../session/revert\"\r\nimport { lazy } from \"../util/lazy\"\r\nimport { Todo } from \"../session/todo\"\r\nimport { InstanceBootstrap } from \"../project/bootstrap\"\r\nimport { MCP } from \"../mcp\"\r\nimport { Storage } from \"../storage/storage\"\r\nimport type { ContentfulStatusCode } from \"hono/utils/http-status\"\r\nimport { TuiEvent } from \"@/cli/cmd/tui/event\"\r\nimport { Snapshot } from \"@/snapshot\"\r\nimport { SessionSummary } from \"@/session/summary\"\r\nimport { SessionStatus } from \"@/session/status\"\r\nimport { upgradeWebSocket, websocket } from \"hono/bun\"\r\nimport { errors } from \"./error\"\r\nimport { Pty } from \"@/pty\"\r\n\r\n// @ts-ignore This global is needed to prevent ai-sdk from logging warnings to stdout https://github.com/vercel/ai/blob/2dc67e0ef538307f21368db32d5a12345d98831b/packages/ai/src/logger/log-warnings.ts#L85\r\nglobalThis.AI_SDK_LOG_WARNINGS = false\r\n\r\nexport namespace Server {\r\n  const log = Log.create({ service: \"server\" })\r\n\r\n  export const Event = {\r\n    Connected: BusEvent.define(\"server.connected\", z.object({})),\r\n    Disposed: BusEvent.define(\"global.disposed\", z.object({})),\r\n  }\r\n\r\n  const app = new Hono()\r\n  export const App = lazy(() =>\r\n    app\r\n      .onError((err, c) => {\r\n        log.error(\"failed\", {\r\n          error: err,\r\n        })\r\n        if (err instanceof NamedError) {\r\n          let status: ContentfulStatusCode\r\n          if (err instanceof Storage.NotFoundError) status = 404\r\n          else if (err instanceof Provider.ModelNotFoundError) status = 400\r\n          else status = 500\r\n          return c.json(err.toObject(), { status })\r\n        }\r\n        const message = err instanceof Error && err.stack ? err.stack : err.toString()\r\n        return c.json(new NamedError.Unknown({ message }).toObject(), {\r\n          status: 500,\r\n        })\r\n      })\r\n      .use(async (c, next) => {\r\n        const skipLogging = c.req.path === \"/log\"\r\n        if (!skipLogging) {\r\n          log.info(\"request\", {\r\n            method: c.req.method,\r\n            path: c.req.path,\r\n          })\r\n        }\r\n        const timer = log.time(\"request\", {\r\n          method: c.req.method,\r\n          path: c.req.path,\r\n        })\r\n        await next()\r\n        if (!skipLogging) {\r\n          timer.stop()\r\n        }\r\n      })\r\n      .use(cors())\r\n      .get(\r\n        \"/global/event\",\r\n        describeRoute({\r\n          summary: \"Get global events\",\r\n          description: \"Subscribe to global events from the OpenCode system using server-sent events.\",\r\n          operationId: \"global.event\",\r\n          responses: {\r\n      ","description":""},"time":{"start":1765923900332}}}}}

data: {"type":"message.updated","properties":{"info":{"id":"msg_b29444ba0001Qw1NYu2ZiH1ZyP","sessionID":"ses_4d6bbb493ffe34xOEDKbcKWwTr","role":"assistant","time":{"created":1765923900321,"completed":1765923900443},"parentID":"msg_b29444b8c001yTVNO9Cg5ZhQ4t","modelID":"big-pickle","providerID":"opencode","mode":"general","agent":"general","path":{"cwd":"/work","root":"/work"},"cost":0,"tokens":{"input":0,"output":0,"reasoning":0,"cache":{"read":0,"write":0}}}}}

data: {"type":"message.part.updated","properties":{"part":{"id":"prt_b29444bab001gzVNlD3h8OS3JO","sessionID":"ses_4d6bbb493ffe34xOEDKbcKWwTr","messageID":"msg_b29444ba0001Qw1NYu2ZiH1ZyP","type":"tool","callID":"01KCMM8JXCRV1XD74VAQ5WSAWR","tool":"bash","state":{"status":"completed","input":{"command":"head -c 4096 -- '/work/packages/opencode/src/server/server.ts'"},"output":"import { BusEvent } from \"@/bus/bus-event\"\r\nimport { Bus } from \"@/bus\"\r\nimport { GlobalBus } from \"@/bus/global\"\r\nimport { Log } from \"../util/log\"\r\nimport { describeRoute, generateSpecs, validator, resolver, openAPIRouteHandler } from \"hono-openapi\"\r\nimport { Hono } from \"hono\"\r\nimport { cors } from \"hono/cors\"\r\nimport { stream, streamSSE } from \"hono/streaming\"\r\nimport { proxy } from \"hono/proxy\"\r\nimport { Session } from \"../session\"\r\nimport z from \"zod\"\r\nimport { Provider } from \"../provider/provider\"\r\nimport { filter, mapValues, sortBy, pipe } from \"remeda\"\r\nimport { NamedError } from \"@opencode-ai/util/error\"\r\nimport { ModelsDev } from \"../provider/models\"\r\nimport { Ripgrep } from \"../file/ripgrep\"\r\nimport { Config } from \"../config/config\"\r\nimport { File } from \"../file\"\r\nimport { LSP } from \"../lsp\"\r\nimport { Format } from \"../format\"\r\nimport { MessageV2 } from \"../session/message-v2\"\r\nimport { TuiRoute } from \"./tui\"\r\nimport { Permission } from \"../permission\"\r\nimport { Instance } from \"../project/instance\"\r\nimport { Vcs } from \"../project/vcs\"\r\nimport { Agent } from \"../agent/agent\"\r\nimport { Auth } from \"../auth\"\r\nimport { Command } from \"../command\"\r\nimport { ProviderAuth } from \"../provider/auth\"\r\nimport { Global } from \"../global\"\r\nimport { ProjectRoute } from \"./project\"\r\nimport { ToolRegistry } from \"../tool/registry\"\r\nimport { zodToJsonSchema } from \"zod-to-json-schema\"\r\nimport { SessionPrompt } from \"../session/prompt\"\r\nimport { SessionCompaction } from \"../session/compaction\"\r\nimport { SessionRevert } from \"../session/revert\"\r\nimport { lazy } from \"../util/lazy\"\r\nimport { Todo } from \"../session/todo\"\r\nimport { InstanceBootstrap } from \"../project/bootstrap\"\r\nimport { MCP } from \"../mcp\"\r\nimport { Storage } from \"../storage/storage\"\r\nimport type { ContentfulStatusCode } from \"hono/utils/http-status\"\r\nimport { TuiEvent } from \"@/cli/cmd/tui/event\"\r\nimport { Snapshot } from \"@/snapshot\"\r\nimport { SessionSummary } from \"@/session/summary\"\r\nimport { SessionStatus } from \"@/session/status\"\r\nimport { upgradeWebSocket, websocket } from \"hono/bun\"\r\nimport { errors } from \"./error\"\r\nimport { Pty } from \"@/pty\"\r\n\r\n// @ts-ignore This global is needed to prevent ai-sdk from logging warnings to stdout https://github.com/vercel/ai/blob/2dc67e0ef538307f21368db32d5a12345d98831b/packages/ai/src/logger/log-warnings.ts#L85\r\nglobalThis.AI_SDK_LOG_WARNINGS = false\r\n\r\nexport namespace Server {\r\n  const log = Log.create({ service: \"server\" })\r\n\r\n  export const Event = {\r\n    Connected: BusEvent.define(\"server.connected\", z.object({})),\r\n    Disposed: BusEvent.define(\"global.disposed\", z.object({})),\r\n  }\r\n\r\n  const app = new Hono()\r\n  export const App = lazy(() =>\r\n    app\r\n      .onError((err, c) => {\r\n        log.error(\"failed\", {\r\n          error: err,\r\n        })\r\n        if (err instanceof NamedError) {\r\n          let status: ContentfulStatusCode\r\n          if (err instanceof Storage.NotFoundError) status = 404\r\n          else if (err instanceof Provider.ModelNotFoundError) status = 400\r\n          else status = 500\r\n          return c.json(err.toObject(), { status })\r\n        }\r\n        const message = err instanceof Error && err.stack ? err.stack : err.toString()\r\n        return c.json(new NamedError.Unknown({ message }).toObject(), {\r\n          status: 500,\r\n        })\r\n      })\r\n      .use(async (c, next) => {\r\n        const skipLogging = c.req.path === \"/log\"\r\n        if (!skipLogging) {\r\n          log.info(\"request\", {\r\n            method: c.req.method,\r\n            path: c.req.path,\r\n          })\r\n        }\r\n        const timer = log.time(\"request\", {\r\n          method: c.req.method,\r\n          path: c.req.path,\r\n        })\r\n        await next()\r\n        if (!skipLogging) {\r\n          timer.stop()\r\n        }\r\n      })\r\n      .use(cors())\r\n      .get(\r\n        \"/global/event\",\r\n        describeRoute({\r\n          summary: \"Get global events\",\r\n          description: \"Subscribe to global events from the OpenCode system using server-sent events.\",\r\n          operationId: \"global.event\",\r\n          responses: {\r\n      ","title":"","metadata":{"output":"import { BusEvent } from \"@/bus/bus-event\"\r\nimport { Bus } from \"@/bus\"\r\nimport { GlobalBus } from \"@/bus/global\"\r\nimport { Log } from \"../util/log\"\r\nimport { describeRoute, generateSpecs, validator, resolver, openAPIRouteHandler } from \"hono-openapi\"\r\nimport { Hono } from \"hono\"\r\nimport { cors } from \"hono/cors\"\r\nimport { stream, streamSSE } from \"hono/streaming\"\r\nimport { proxy } from \"hono/proxy\"\r\nimport { Session } from \"../session\"\r\nimport z from \"zod\"\r\nimport { Provider } from \"../provider/provider\"\r\nimport { filter, mapValues, sortBy, pipe } from \"remeda\"\r\nimport { NamedError } from \"@opencode-ai/util/error\"\r\nimport { ModelsDev } from \"../provider/models\"\r\nimport { Ripgrep } from \"../file/ripgrep\"\r\nimport { Config } from \"../config/config\"\r\nimport { File } from \"../file\"\r\nimport { LSP } from \"../lsp\"\r\nimport { Format } from \"../format\"\r\nimport { MessageV2 } from \"../session/message-v2\"\r\nimport { TuiRoute } from \"./tui\"\r\nimport { Permission } from \"../permission\"\r\nimport { Instance } from \"../project/instance\"\r\nimport { Vcs } from \"../project/vcs\"\r\nimport { Agent } from \"../agent/agent\"\r\nimport { Auth } from \"../auth\"\r\nimport { Command } from \"../command\"\r\nimport { ProviderAuth } from \"../provider/auth\"\r\nimport { Global } from \"../global\"\r\nimport { ProjectRoute } from \"./project\"\r\nimport { ToolRegistry } from \"../tool/registry\"\r\nimport { zodToJsonSchema } from \"zod-to-json-schema\"\r\nimport { SessionPrompt } from \"../session/prompt\"\r\nimport { SessionCompaction } from \"../session/compaction\"\r\nimport { SessionRevert } from \"../session/revert\"\r\nimport { lazy } from \"../util/lazy\"\r\nimport { Todo } from \"../session/todo\"\r\nimport { InstanceBootstrap } from \"../project/bootstrap\"\r\nimport { MCP } from \"../mcp\"\r\nimport { Storage } from \"../storage/storage\"\r\nimport type { ContentfulStatusCode } from \"hono/utils/http-status\"\r\nimport { TuiEvent } from \"@/cli/cmd/tui/event\"\r\nimport { Snapshot } from \"@/snapshot\"\r\nimport { SessionSummary } from \"@/session/summary\"\r\nimport { SessionStatus } from \"@/session/status\"\r\nimport { upgradeWebSocket, websocket } from \"hono/bun\"\r\nimport { errors } from \"./error\"\r\nimport { Pty } from \"@/pty\"\r\n\r\n// @ts-ignore This global is needed to prevent ai-sdk from logging warnings to stdout https://github.com/vercel/ai/blob/2dc67e0ef538307f21368db32d5a12345d98831b/packages/ai/src/logger/log-warnings.ts#L85\r\nglobalThis.AI_SDK_LOG_WARNINGS = false\r\n\r\nexport namespace Server {\r\n  const log = Log.create({ service: \"server\" })\r\n\r\n  export const Event = {\r\n    Connected: BusEvent.define(\"server.connected\", z.object({})),\r\n    Disposed: BusEvent.define(\"global.disposed\", z.object({})),\r\n  }\r\n\r\n  const app = new Hono()\r\n  export const App = lazy(() =>\r\n    app\r\n      .onError((err, c) => {\r\n        log.error(\"failed\", {\r\n          error: err,\r\n        })\r\n        if (err instanceof NamedError) {\r\n          let status: ContentfulStatusCode\r\n          if (err instanceof Storage.NotFoundError) status = 404\r\n          else if (err instanceof Provider.ModelNotFoundError) status = 400\r\n          else status = 500\r\n          return c.json(err.toObject(), { status })\r\n        }\r\n        const message = err instanceof Error && err.stack ? err.stack : err.toString()\r\n        return c.json(new NamedError.Unknown({ message }).toObject(), {\r\n          status: 500,\r\n        })\r\n      })\r\n      .use(async (c, next) => {\r\n        const skipLogging = c.req.path === \"/log\"\r\n        if (!skipLogging) {\r\n          log.info(\"request\", {\r\n            method: c.req.method,\r\n            path: c.req.path,\r\n          })\r\n        }\r\n        const timer = log.time(\"request\", {\r\n          method: c.req.method,\r\n          path: c.req.path,\r\n        })\r\n        await next()\r\n        if (!skipLogging) {\r\n          timer.stop()\r\n        }\r\n      })\r\n      .use(cors())\r\n      .get(\r\n        \"/global/event\",\r\n        describeRoute({\r\n          summary: \"Get global events\",\r\n          description: \"Subscribe to global events from the OpenCode system using server-sent events.\",\r\n          operationId: \"global.event\",\r\n          responses: {\r\n      ","description":""},"time":{"start":1765923900332,"end":1765923900451}}}}}

data: {"type":"session.status","properties":{"sessionID":"ses_4d6bbb493ffe34xOEDKbcKWwTr","status":{"type":"idle"}}}

data: {"type":"session.idle","properties":{"sessionID":"ses_4d6bbb493ffe34xOEDKbcKWwTr"}}

data: {"type":"session.created","properties":{"info":{"id":"ses_4d6b8544affe3SocXWtZGdupEy","version":"local","projectID":"global","directory":"/work","title":"New session - 2025-12-16T22:28:41.525Z","time":{"created":1765924121525,"updated":1765924121525}}}}

data: {"type":"session.updated","properties":{"info":{"id":"ses_4d6b8544affe3SocXWtZGdupEy","version":"local","projectID":"global","directory":"/work","title":"New session - 2025-12-16T22:28:41.525Z","time":{"created":1765924121525,"updated":1765924121525}}}}

data: {"type":"message.updated","properties":{"info":{"id":"msg_b2947abd5001WXr0RxhG81RmD2","sessionID":"ses_4d6b8544affe3SocXWtZGdupEy","role":"user","time":{"created":1765924121557},"agent":"general","model":{"providerID":"opencode","modelID":"big-pickle"}}}}

data: {"type":"message.part.updated","properties":{"part":{"id":"prt_b2947abdb001PSsfPNBF4yQbyI","sessionID":"ses_4d6b8544affe3SocXWtZGdupEy","messageID":"msg_b2947abd5001WXr0RxhG81RmD2","type":"text","text":"The following tool was executed by the user","synthetic":true}}}

data: {"type":"message.updated","properties":{"info":{"id":"msg_b2947abed001JKYhawqCS87TdQ","sessionID":"ses_4d6b8544affe3SocXWtZGdupEy","role":"assistant","time":{"created":1765924121581},"parentID":"msg_b2947abd5001WXr0RxhG81RmD2","modelID":"big-pickle","providerID":"opencode","mode":"general","agent":"general","path":{"cwd":"/work","root":"/work"},"cost":0,"tokens":{"input":0,"output":0,"reasoning":0,"cache":{"read":0,"write":0}}}}}

data: {"type":"message.part.updated","properties":{"part":{"id":"prt_b2947ac01001S5VufYvTY4wvEm","sessionID":"ses_4d6b8544affe3SocXWtZGdupEy","messageID":"msg_b2947abed001JKYhawqCS87TdQ","type":"tool","callID":"01KCMMFB01Y3J2PBJ27HKD1YSM","tool":"bash","state":{"status":"running","input":{"command":"head -c 4096 -- '/work/packages/opencode/src/server/server.ts'"},"time":{"start":1765924121601}}}}}

data: {"type":"message.part.updated","properties":{"part":{"id":"prt_b2947ac01001S5VufYvTY4wvEm","sessionID":"ses_4d6b8544affe3SocXWtZGdupEy","messageID":"msg_b2947abed001JKYhawqCS87TdQ","type":"tool","callID":"01KCMMFB01Y3J2PBJ27HKD1YSM","tool":"bash","state":{"status":"running","input":{"command":"head -c 4096 -- '/work/packages/opencode/src/server/server.ts'"},"metadata":{"output":"import { BusEvent } from \"@/bus/bus-event\"\r\nimport { Bus } from \"@/bus\"\r\nimport { GlobalBus } from \"@/bus/global\"\r\nimport { Log } from \"../util/log\"\r\nimport { describeRoute, generateSpecs, validator, resolver, openAPIRouteHandler } from \"hono-openapi\"\r\nimport { Hono } from \"hono\"\r\nimport { cors } from \"hono/cors\"\r\nimport { stream, streamSSE } from \"hono/streaming\"\r\nimport { proxy } from \"hono/proxy\"\r\nimport { Session } from \"../session\"\r\nimport z from \"zod\"\r\nimport { Provider } from \"../provider/provider\"\r\nimport { filter, mapValues, sortBy, pipe } from \"remeda\"\r\nimport { NamedError } from \"@opencode-ai/util/error\"\r\nimport { ModelsDev } from \"../provider/models\"\r\nimport { Ripgrep } from \"../file/ripgrep\"\r\nimport { Config } from \"../config/config\"\r\nimport { File } from \"../file\"\r\nimport { LSP } from \"../lsp\"\r\nimport { Format } from \"../format\"\r\nimport { MessageV2 } from \"../session/message-v2\"\r\nimport { TuiRoute } from \"./tui\"\r\nimport { Permission } from \"../permission\"\r\nimport { Instance } from \"../project/instance\"\r\nimport { Vcs } from \"../project/vcs\"\r\nimport { Agent } from \"../agent/agent\"\r\nimport { Auth } from \"../auth\"\r\nimport { Command } from \"../command\"\r\nimport { ProviderAuth } from \"../provider/auth\"\r\nimport { Global } from \"../global\"\r\nimport { ProjectRoute } from \"./project\"\r\nimport { ToolRegistry } from \"../tool/registry\"\r\nimport { zodToJsonSchema } from \"zod-to-json-schema\"\r\nimport { SessionPrompt } from \"../session/prompt\"\r\nimport { SessionCompaction } from \"../session/compaction\"\r\nimport { SessionRevert } from \"../session/revert\"\r\nimport { lazy } from \"../util/lazy\"\r\nimport { Todo } from \"../session/todo\"\r\nimport { InstanceBootstrap } from \"../project/bootstrap\"\r\nimport { MCP } from \"../mcp\"\r\nimport { Storage } from \"../storage/storage\"\r\nimport type { ContentfulStatusCode } from \"hono/utils/http-status\"\r\nimport { TuiEvent } from \"@/cli/cmd/tui/event\"\r\nimport { Snapshot } from \"@/snapshot\"\r\nimport { SessionSummary } from \"@/session/summary\"\r\nimport { SessionStatus } from \"@/session/status\"\r\nimport { upgradeWebSocket, websocket } from \"hono/bun\"\r\nimport { errors } from \"./error\"\r\nimport { Pty } from \"@/pty\"\r\n\r\n// @ts-ignore This global is needed to prevent ai-sdk from logging warnings to stdout https://github.com/vercel/ai/blob/2dc67e0ef538307f21368db32d5a12345d98831b/packages/ai/src/logger/log-warnings.ts#L85\r\nglobalThis.AI_SDK_LOG_WARNINGS = false\r\n\r\nexport namespace Server {\r\n  const log = Log.create({ service: \"server\" })\r\n\r\n  export const Event = {\r\n    Connected: BusEvent.define(\"server.connected\", z.object({})),\r\n    Disposed: BusEvent.define(\"global.disposed\", z.object({})),\r\n  }\r\n\r\n  const app = new Hono()\r\n  export const App = lazy(() =>\r\n    app\r\n      .onError((err, c) => {\r\n        log.error(\"failed\", {\r\n          error: err,\r\n        })\r\n        if (err instanceof NamedError) {\r\n          let status: ContentfulStatusCode\r\n          if (err instanceof Storage.NotFoundError) status = 404\r\n          else if (err instanceof Provider.ModelNotFoundError) status = 400\r\n          else status = 500\r\n          return c.json(err.toObject(), { status })\r\n        }\r\n        const message = err instanceof Error && err.stack ? err.stack : err.toString()\r\n        return c.json(new NamedError.Unknown({ message }).toObject(), {\r\n          status: 500,\r\n        })\r\n      })\r\n      .use(async (c, next) => {\r\n        const skipLogging = c.req.path === \"/log\"\r\n        if (!skipLogging) {\r\n          log.info(\"request\", {\r\n            method: c.req.method,\r\n            path: c.req.path,\r\n          })\r\n        }\r\n        const timer = log.time(\"request\", {\r\n          method: c.req.method,\r\n          path: c.req.path,\r\n        })\r\n        await next()\r\n        if (!skipLogging) {\r\n          timer.stop()\r\n        }\r\n      })\r\n      .use(cors())\r\n      .get(\r\n        \"/global/event\",\r\n        describeRoute({\r\n          summary: \"Get global events\",\r\n          description: \"Subscribe to global events from the OpenCode system using server-sent events.\",\r\n          operationId: \"global.event\",\r\n          responses: {\r\n      ","description":""},"time":{"start":1765924121601}}}}}

data: {"type":"message.updated","properties":{"info":{"id":"msg_b2947abed001JKYhawqCS87TdQ","sessionID":"ses_4d6b8544affe3SocXWtZGdupEy","role":"assistant","time":{"created":1765924121581,"completed":1765924121677},"parentID":"msg_b2947abd5001WXr0RxhG81RmD2","modelID":"big-pickle","providerID":"opencode","mode":"general","agent":"general","path":{"cwd":"/work","root":"/work"},"cost":0,"tokens":{"input":0,"output":0,"reasoning":0,"cache":{"read":0,"write":0}}}}}

data: {"type":"message.part.updated","properties":{"part":{"id":"prt_b2947ac01001S5VufYvTY4wvEm","sessionID":"ses_4d6b8544affe3SocXWtZGdupEy","messageID":"msg_b2947abed001JKYhawqCS87TdQ","type":"tool","callID":"01KCMMFB01Y3J2PBJ27HKD1YSM","tool":"bash","state":{"status":"completed","input":{"command":"head -c 4096 -- '/work/packages/opencode/src/server/server.ts'"},"output":"import { BusEvent } from \"@/bus/bus-event\"\r\nimport { Bus } from \"@/bus\"\r\nimport { GlobalBus } from \"@/bus/global\"\r\nimport { Log } from \"../util/log\"\r\nimport { describeRoute, generateSpecs, validator, resolver, openAPIRouteHandler } from \"hono-openapi\"\r\nimport { Hono } from \"hono\"\r\nimport { cors } from \"hono/cors\"\r\nimport { stream, streamSSE } from \"hono/streaming\"\r\nimport { proxy } from \"hono/proxy\"\r\nimport { Session } from \"../session\"\r\nimport z from \"zod\"\r\nimport { Provider } from \"../provider/provider\"\r\nimport { filter, mapValues, sortBy, pipe } from \"remeda\"\r\nimport { NamedError } from \"@opencode-ai/util/error\"\r\nimport { ModelsDev } from \"../provider/models\"\r\nimport { Ripgrep } from \"../file/ripgrep\"\r\nimport { Config } from \"../config/config\"\r\nimport { File } from \"../file\"\r\nimport { LSP } from \"../lsp\"\r\nimport { Format } from \"../format\"\r\nimport { MessageV2 } from \"../session/message-v2\"\r\nimport { TuiRoute } from \"./tui\"\r\nimport { Permission } from \"../permission\"\r\nimport { Instance } from \"../project/instance\"\r\nimport { Vcs } from \"../project/vcs\"\r\nimport { Agent } from \"../agent/agent\"\r\nimport { Auth } from \"../auth\"\r\nimport { Command } from \"../command\"\r\nimport { ProviderAuth } from \"../provider/auth\"\r\nimport { Global } from \"../global\"\r\nimport { ProjectRoute } from \"./project\"\r\nimport { ToolRegistry } from \"../tool/registry\"\r\nimport { zodToJsonSchema } from \"zod-to-json-schema\"\r\nimport { SessionPrompt } from \"../session/prompt\"\r\nimport { SessionCompaction } from \"../session/compaction\"\r\nimport { SessionRevert } from \"../session/revert\"\r\nimport { lazy } from \"../util/lazy\"\r\nimport { Todo } from \"../session/todo\"\r\nimport { InstanceBootstrap } from \"../project/bootstrap\"\r\nimport { MCP } from \"../mcp\"\r\nimport { Storage } from \"../storage/storage\"\r\nimport type { ContentfulStatusCode } from \"hono/utils/http-status\"\r\nimport { TuiEvent } from \"@/cli/cmd/tui/event\"\r\nimport { Snapshot } from \"@/snapshot\"\r\nimport { SessionSummary } from \"@/session/summary\"\r\nimport { SessionStatus } from \"@/session/status\"\r\nimport { upgradeWebSocket, websocket } from \"hono/bun\"\r\nimport { errors } from \"./error\"\r\nimport { Pty } from \"@/pty\"\r\n\r\n// @ts-ignore This global is needed to prevent ai-sdk from logging warnings to stdout https://github.com/vercel/ai/blob/2dc67e0ef538307f21368db32d5a12345d98831b/packages/ai/src/logger/log-warnings.ts#L85\r\nglobalThis.AI_SDK_LOG_WARNINGS = false\r\n\r\nexport namespace Server {\r\n  const log = Log.create({ service: \"server\" })\r\n\r\n  export const Event = {\r\n    Connected: BusEvent.define(\"server.connected\", z.object({})),\r\n    Disposed: BusEvent.define(\"global.disposed\", z.object({})),\r\n  }\r\n\r\n  const app = new Hono()\r\n  export const App = lazy(() =>\r\n    app\r\n      .onError((err, c) => {\r\n        log.error(\"failed\", {\r\n          error: err,\r\n        })\r\n        if (err instanceof NamedError) {\r\n          let status: ContentfulStatusCode\r\n          if (err instanceof Storage.NotFoundError) status = 404\r\n          else if (err instanceof Provider.ModelNotFoundError) status = 400\r\n          else status = 500\r\n          return c.json(err.toObject(), { status })\r\n        }\r\n        const message = err instanceof Error && err.stack ? err.stack : err.toString()\r\n        return c.json(new NamedError.Unknown({ message }).toObject(), {\r\n          status: 500,\r\n        })\r\n      })\r\n      .use(async (c, next) => {\r\n        const skipLogging = c.req.path === \"/log\"\r\n        if (!skipLogging) {\r\n          log.info(\"request\", {\r\n            method: c.req.method,\r\n            path: c.req.path,\r\n          })\r\n        }\r\n        const timer = log.time(\"request\", {\r\n          method: c.req.method,\r\n          path: c.req.path,\r\n        })\r\n        await next()\r\n        if (!skipLogging) {\r\n          timer.stop()\r\n        }\r\n      })\r\n      .use(cors())\r\n      .get(\r\n        \"/global/event\",\r\n        describeRoute({\r\n          summary: \"Get global events\",\r\n          description: \"Subscribe to global events from the OpenCode system using server-sent events.\",\r\n          operationId: \"global.event\",\r\n          responses: {\r\n      ","title":"","metadata":{"output":"import { BusEvent } from \"@/bus/bus-event\"\r\nimport { Bus } from \"@/bus\"\r\nimport { GlobalBus } from \"@/bus/global\"\r\nimport { Log } from \"../util/log\"\r\nimport { describeRoute, generateSpecs, validator, resolver, openAPIRouteHandler } from \"hono-openapi\"\r\nimport { Hono } from \"hono\"\r\nimport { cors } from \"hono/cors\"\r\nimport { stream, streamSSE } from \"hono/streaming\"\r\nimport { proxy } from \"hono/proxy\"\r\nimport { Session } from \"../session\"\r\nimport z from \"zod\"\r\nimport { Provider } from \"../provider/provider\"\r\nimport { filter, mapValues, sortBy, pipe } from \"remeda\"\r\nimport { NamedError } from \"@opencode-ai/util/error\"\r\nimport { ModelsDev } from \"../provider/models\"\r\nimport { Ripgrep } from \"../file/ripgrep\"\r\nimport { Config } from \"../config/config\"\r\nimport { File } from \"../file\"\r\nimport { LSP } from \"../lsp\"\r\nimport { Format } from \"../format\"\r\nimport { MessageV2 } from \"../session/message-v2\"\r\nimport { TuiRoute } from \"./tui\"\r\nimport { Permission } from \"../permission\"\r\nimport { Instance } from \"../project/instance\"\r\nimport { Vcs } from \"../project/vcs\"\r\nimport { Agent } from \"../agent/agent\"\r\nimport { Auth } from \"../auth\"\r\nimport { Command } from \"../command\"\r\nimport { ProviderAuth } from \"../provider/auth\"\r\nimport { Global } from \"../global\"\r\nimport { ProjectRoute } from \"./project\"\r\nimport { ToolRegistry } from \"../tool/registry\"\r\nimport { zodToJsonSchema } from \"zod-to-json-schema\"\r\nimport { SessionPrompt } from \"../session/prompt\"\r\nimport { SessionCompaction } from \"../session/compaction\"\r\nimport { SessionRevert } from \"../session/revert\"\r\nimport { lazy } from \"../util/lazy\"\r\nimport { Todo } from \"../session/todo\"\r\nimport { InstanceBootstrap } from \"../project/bootstrap\"\r\nimport { MCP } from \"../mcp\"\r\nimport { Storage } from \"../storage/storage\"\r\nimport type { ContentfulStatusCode } from \"hono/utils/http-status\"\r\nimport { TuiEvent } from \"@/cli/cmd/tui/event\"\r\nimport { Snapshot } from \"@/snapshot\"\r\nimport { SessionSummary } from \"@/session/summary\"\r\nimport { SessionStatus } from \"@/session/status\"\r\nimport { upgradeWebSocket, websocket } from \"hono/bun\"\r\nimport { errors } from \"./error\"\r\nimport { Pty } from \"@/pty\"\r\n\r\n// @ts-ignore This global is needed to prevent ai-sdk from logging warnings to stdout https://github.com/vercel/ai/blob/2dc67e0ef538307f21368db32d5a12345d98831b/packages/ai/src/logger/log-warnings.ts#L85\r\nglobalThis.AI_SDK_LOG_WARNINGS = false\r\n\r\nexport namespace Server {\r\n  const log = Log.create({ service: \"server\" })\r\n\r\n  export const Event = {\r\n    Connected: BusEvent.define(\"server.connected\", z.object({})),\r\n    Disposed: BusEvent.define(\"global.disposed\", z.object({})),\r\n  }\r\n\r\n  const app = new Hono()\r\n  export const App = lazy(() =>\r\n    app\r\n      .onError((err, c) => {\r\n        log.error(\"failed\", {\r\n          error: err,\r\n        })\r\n        if (err instanceof NamedError) {\r\n          let status: ContentfulStatusCode\r\n          if (err instanceof Storage.NotFoundError) status = 404\r\n          else if (err instanceof Provider.ModelNotFoundError) status = 400\r\n          else status = 500\r\n          return c.json(err.toObject(), { status })\r\n        }\r\n        const message = err instanceof Error && err.stack ? err.stack : err.toString()\r\n        return c.json(new NamedError.Unknown({ message }).toObject(), {\r\n          status: 500,\r\n        })\r\n      })\r\n      .use(async (c, next) => {\r\n        const skipLogging = c.req.path === \"/log\"\r\n        if (!skipLogging) {\r\n          log.info(\"request\", {\r\n            method: c.req.method,\r\n            path: c.req.path,\r\n          })\r\n        }\r\n        const timer = log.time(\"request\", {\r\n          method: c.req.method,\r\n          path: c.req.path,\r\n        })\r\n        await next()\r\n        if (!skipLogging) {\r\n          timer.stop()\r\n        }\r\n      })\r\n      .use(cors())\r\n      .get(\r\n        \"/global/event\",\r\n        describeRoute({\r\n          summary: \"Get global events\",\r\n          description: \"Subscribe to global events from the OpenCode system using server-sent events.\",\r\n          operationId: \"global.event\",\r\n          responses: {\r\n      ","description":""},"time":{"start":1765924121601,"end":1765924121679}}}}}

data: {"type":"session.status","properties":{"sessionID":"ses_4d6b8544affe3SocXWtZGdupEy","status":{"type":"idle"}}}

data: {"type":"session.idle","properties":{"sessionID":"ses_4d6b8544affe3SocXWtZGdupEy"}}


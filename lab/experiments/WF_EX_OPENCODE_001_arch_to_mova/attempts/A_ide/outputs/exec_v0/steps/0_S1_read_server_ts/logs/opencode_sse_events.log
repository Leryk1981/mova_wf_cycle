data: {"type":"server.connected","properties":{}}

data: {"type":"session.created","properties":{"info":{"id":"ses_4d68b3124ffejL6Eob6xu0k5c2","version":"local","projectID":"global","directory":"/work","title":"New session - 2025-12-16T23:17:59.644Z","time":{"created":1765927079644,"updated":1765927079644}}}}

data: {"type":"session.updated","properties":{"info":{"id":"ses_4d68b3124ffejL6Eob6xu0k5c2","version":"local","projectID":"global","directory":"/work","title":"New session - 2025-12-16T23:17:59.644Z","time":{"created":1765927079644,"updated":1765927079644}}}}

data: {"type":"message.updated","properties":{"info":{"id":"msg_b2974cf0d001r85vKMAEzL5CVC","sessionID":"ses_4d68b3124ffejL6Eob6xu0k5c2","role":"user","time":{"created":1765927079693},"agent":"general","model":{"providerID":"opencode","modelID":"big-pickle"}}}}

data: {"type":"message.part.updated","properties":{"part":{"id":"prt_b2974cf1c001SETCJ5Pu7u8AZu","sessionID":"ses_4d68b3124ffejL6Eob6xu0k5c2","messageID":"msg_b2974cf0d001r85vKMAEzL5CVC","type":"text","text":"The following tool was executed by the user","synthetic":true}}}

data: {"type":"message.updated","properties":{"info":{"id":"msg_b2974cf32001rH2X2yTvO3E3a0","sessionID":"ses_4d68b3124ffejL6Eob6xu0k5c2","role":"assistant","time":{"created":1765927079730},"parentID":"msg_b2974cf0d001r85vKMAEzL5CVC","modelID":"big-pickle","providerID":"opencode","mode":"general","agent":"general","path":{"cwd":"/work","root":"/work"},"cost":0,"tokens":{"input":0,"output":0,"reasoning":0,"cache":{"read":0,"write":0}}}}}

data: {"type":"message.part.updated","properties":{"part":{"id":"prt_b2974cf3c0018cEuar7EyYurrA","sessionID":"ses_4d68b3124ffejL6Eob6xu0k5c2","messageID":"msg_b2974cf32001rH2X2yTvO3E3a0","type":"tool","callID":"01KCMQ9KSW560H3YG3MNQ2PRWX","tool":"bash","state":{"status":"running","input":{"command":"head -c 4096 -- '/work/packages/opencode/src/server/server.ts'"},"time":{"start":1765927079740}}}}}

data: {"type":"message.part.updated","properties":{"part":{"id":"prt_b2974cf3c0018cEuar7EyYurrA","sessionID":"ses_4d68b3124ffejL6Eob6xu0k5c2","messageID":"msg_b2974cf32001rH2X2yTvO3E3a0","type":"tool","callID":"01KCMQ9KSW560H3YG3MNQ2PRWX","tool":"bash","state":{"status":"running","input":{"command":"head -c 4096 -- '/work/packages/opencode/src/server/server.ts'"},"metadata":{"output":"import { BusEvent } from \"@/bus/bus-event\"\r\nimport { Bus } from \"@/bus\"\r\nimport { GlobalBus } from \"@/bus/global\"\r\nimport { Log } from \"../util/log\"\r\nimport { describeRoute, generateSpecs, validator, resolver, openAPIRouteHandler } from \"hono-openapi\"\r\nimport { Hono } from \"hono\"\r\nimport { cors } from \"hono/cors\"\r\nimport { stream, streamSSE } from \"hono/streaming\"\r\nimport { proxy } from \"hono/proxy\"\r\nimport { Session } from \"../session\"\r\nimport z from \"zod\"\r\nimport { Provider } from \"../provider/provider\"\r\nimport { filter, mapValues, sortBy, pipe } from \"remeda\"\r\nimport { NamedError } from \"@opencode-ai/util/error\"\r\nimport { ModelsDev } from \"../provider/models\"\r\nimport { Ripgrep } from \"../file/ripgrep\"\r\nimport { Config } from \"../config/config\"\r\nimport { File } from \"../file\"\r\nimport { LSP } from \"../lsp\"\r\nimport { Format } from \"../format\"\r\nimport { MessageV2 } from \"../session/message-v2\"\r\nimport { TuiRoute } from \"./tui\"\r\nimport { Permission } from \"../permission\"\r\nimport { Instance } from \"../project/instance\"\r\nimport { Vcs } from \"../project/vcs\"\r\nimport { Agent } from \"../agent/agent\"\r\nimport { Auth } from \"../auth\"\r\nimport { Command } from \"../command\"\r\nimport { ProviderAuth } from \"../provider/auth\"\r\nimport { Global } from \"../global\"\r\nimport { ProjectRoute } from \"./project\"\r\nimport { ToolRegistry } from \"../tool/registry\"\r\nimport { zodToJsonSchema } from \"zod-to-json-schema\"\r\nimport { SessionPrompt } from \"../session/prompt\"\r\nimport { SessionCompaction } from \"../session/compaction\"\r\nimport { SessionRevert } from \"../session/revert\"\r\nimport { lazy } from \"../util/lazy\"\r\nimport { Todo } from \"../session/todo\"\r\nimport { InstanceBootstrap } from \"../project/bootstrap\"\r\nimport { MCP } from \"../mcp\"\r\nimport { Storage } from \"../storage/storage\"\r\nimport type { ContentfulStatusCode } from \"hono/utils/http-status\"\r\nimport { TuiEvent } from \"@/cli/cmd/tui/event\"\r\nimport { Snapshot } from \"@/snapshot\"\r\nimport { SessionSummary } from \"@/session/summary\"\r\nimport { SessionStatus } from \"@/session/status\"\r\nimport { upgradeWebSocket, websocket } from \"hono/bun\"\r\nimport { errors } from \"./error\"\r\nimport { Pty } from \"@/pty\"\r\n\r\n// @ts-ignore This global is needed to prevent ai-sdk from logging warnings to stdout https://github.com/vercel/ai/blob/2dc67e0ef538307f21368db32d5a12345d98831b/packages/ai/src/logger/log-warnings.ts#L85\r\nglobalThis.AI_SDK_LOG_WARNINGS = false\r\n\r\nexport namespace Server {\r\n  const log = Log.create({ service: \"server\" })\r\n\r\n  export const Event = {\r\n    Connected: BusEvent.define(\"server.connected\", z.object({})),\r\n    Disposed: BusEvent.define(\"global.disposed\", z.object({})),\r\n  }\r\n\r\n  const app = new Hono()\r\n  export const App = lazy(() =>\r\n    app\r\n      .onError((err, c) => {\r\n        log.error(\"failed\", {\r\n          error: err,\r\n        })\r\n        if (err instanceof NamedError) {\r\n          let status: ContentfulStatusCode\r\n          if (err instanceof Storage.NotFoundError) status = 404\r\n          else if (err instanceof Provider.ModelNotFoundError) status = 400\r\n          else status = 500\r\n          return c.json(err.toObject(), { status })\r\n        }\r\n        const message = err instanceof Error && err.stack ? err.stack : err.toString()\r\n        return c.json(new NamedError.Unknown({ message }).toObject(), {\r\n          status: 500,\r\n        })\r\n      })\r\n      .use(async (c, next) => {\r\n        const skipLogging = c.req.path === \"/log\"\r\n        if (!skipLogging) {\r\n          log.info(\"request\", {\r\n            method: c.req.method,\r\n            path: c.req.path,\r\n          })\r\n        }\r\n        const timer = log.time(\"request\", {\r\n          method: c.req.method,\r\n          path: c.req.path,\r\n        })\r\n        await next()\r\n        if (!skipLogging) {\r\n          timer.stop()\r\n        }\r\n      })\r\n      .use(cors())\r\n      .get(\r\n        \"/global/event\",\r\n        describeRoute({\r\n          summary: \"Get global events\",\r\n          description: \"Subscribe to global events from the OpenCode system using server-sent events.\",\r\n          operationId: \"global.event\",\r\n          responses: {\r\n      ","description":""},"time":{"start":1765927079740}}}}}

data: {"type":"message.updated","properties":{"info":{"id":"msg_b2974cf32001rH2X2yTvO3E3a0","sessionID":"ses_4d68b3124ffejL6Eob6xu0k5c2","role":"assistant","time":{"created":1765927079730,"completed":1765927079846},"parentID":"msg_b2974cf0d001r85vKMAEzL5CVC","modelID":"big-pickle","providerID":"opencode","mode":"general","agent":"general","path":{"cwd":"/work","root":"/work"},"cost":0,"tokens":{"input":0,"output":0,"reasoning":0,"cache":{"read":0,"write":0}}}}}

data: {"type":"message.part.updated","properties":{"part":{"id":"prt_b2974cf3c0018cEuar7EyYurrA","sessionID":"ses_4d68b3124ffejL6Eob6xu0k5c2","messageID":"msg_b2974cf32001rH2X2yTvO3E3a0","type":"tool","callID":"01KCMQ9KSW560H3YG3MNQ2PRWX","tool":"bash","state":{"status":"completed","input":{"command":"head -c 4096 -- '/work/packages/opencode/src/server/server.ts'"},"output":"import { BusEvent } from \"@/bus/bus-event\"\r\nimport { Bus } from \"@/bus\"\r\nimport { GlobalBus } from \"@/bus/global\"\r\nimport { Log } from \"../util/log\"\r\nimport { describeRoute, generateSpecs, validator, resolver, openAPIRouteHandler } from \"hono-openapi\"\r\nimport { Hono } from \"hono\"\r\nimport { cors } from \"hono/cors\"\r\nimport { stream, streamSSE } from \"hono/streaming\"\r\nimport { proxy } from \"hono/proxy\"\r\nimport { Session } from \"../session\"\r\nimport z from \"zod\"\r\nimport { Provider } from \"../provider/provider\"\r\nimport { filter, mapValues, sortBy, pipe } from \"remeda\"\r\nimport { NamedError } from \"@opencode-ai/util/error\"\r\nimport { ModelsDev } from \"../provider/models\"\r\nimport { Ripgrep } from \"../file/ripgrep\"\r\nimport { Config } from \"../config/config\"\r\nimport { File } from \"../file\"\r\nimport { LSP } from \"../lsp\"\r\nimport { Format } from \"../format\"\r\nimport { MessageV2 } from \"../session/message-v2\"\r\nimport { TuiRoute } from \"./tui\"\r\nimport { Permission } from \"../permission\"\r\nimport { Instance } from \"../project/instance\"\r\nimport { Vcs } from \"../project/vcs\"\r\nimport { Agent } from \"../agent/agent\"\r\nimport { Auth } from \"../auth\"\r\nimport { Command } from \"../command\"\r\nimport { ProviderAuth } from \"../provider/auth\"\r\nimport { Global } from \"../global\"\r\nimport { ProjectRoute } from \"./project\"\r\nimport { ToolRegistry } from \"../tool/registry\"\r\nimport { zodToJsonSchema } from \"zod-to-json-schema\"\r\nimport { SessionPrompt } from \"../session/prompt\"\r\nimport { SessionCompaction } from \"../session/compaction\"\r\nimport { SessionRevert } from \"../session/revert\"\r\nimport { lazy } from \"../util/lazy\"\r\nimport { Todo } from \"../session/todo\"\r\nimport { InstanceBootstrap } from \"../project/bootstrap\"\r\nimport { MCP } from \"../mcp\"\r\nimport { Storage } from \"../storage/storage\"\r\nimport type { ContentfulStatusCode } from \"hono/utils/http-status\"\r\nimport { TuiEvent } from \"@/cli/cmd/tui/event\"\r\nimport { Snapshot } from \"@/snapshot\"\r\nimport { SessionSummary } from \"@/session/summary\"\r\nimport { SessionStatus } from \"@/session/status\"\r\nimport { upgradeWebSocket, websocket } from \"hono/bun\"\r\nimport { errors } from \"./error\"\r\nimport { Pty } from \"@/pty\"\r\n\r\n// @ts-ignore This global is needed to prevent ai-sdk from logging warnings to stdout https://github.com/vercel/ai/blob/2dc67e0ef538307f21368db32d5a12345d98831b/packages/ai/src/logger/log-warnings.ts#L85\r\nglobalThis.AI_SDK_LOG_WARNINGS = false\r\n\r\nexport namespace Server {\r\n  const log = Log.create({ service: \"server\" })\r\n\r\n  export const Event = {\r\n    Connected: BusEvent.define(\"server.connected\", z.object({})),\r\n    Disposed: BusEvent.define(\"global.disposed\", z.object({})),\r\n  }\r\n\r\n  const app = new Hono()\r\n  export const App = lazy(() =>\r\n    app\r\n      .onError((err, c) => {\r\n        log.error(\"failed\", {\r\n          error: err,\r\n        })\r\n        if (err instanceof NamedError) {\r\n          let status: ContentfulStatusCode\r\n          if (err instanceof Storage.NotFoundError) status = 404\r\n          else if (err instanceof Provider.ModelNotFoundError) status = 400\r\n          else status = 500\r\n          return c.json(err.toObject(), { status })\r\n        }\r\n        const message = err instanceof Error && err.stack ? err.stack : err.toString()\r\n        return c.json(new NamedError.Unknown({ message }).toObject(), {\r\n          status: 500,\r\n        })\r\n      })\r\n      .use(async (c, next) => {\r\n        const skipLogging = c.req.path === \"/log\"\r\n        if (!skipLogging) {\r\n          log.info(\"request\", {\r\n            method: c.req.method,\r\n            path: c.req.path,\r\n          })\r\n        }\r\n        const timer = log.time(\"request\", {\r\n          method: c.req.method,\r\n          path: c.req.path,\r\n        })\r\n        await next()\r\n        if (!skipLogging) {\r\n          timer.stop()\r\n        }\r\n      })\r\n      .use(cors())\r\n      .get(\r\n        \"/global/event\",\r\n        describeRoute({\r\n          summary: \"Get global events\",\r\n          description: \"Subscribe to global events from the OpenCode system using server-sent events.\",\r\n          operationId: \"global.event\",\r\n          responses: {\r\n      ","title":"","metadata":{"output":"import { BusEvent } from \"@/bus/bus-event\"\r\nimport { Bus } from \"@/bus\"\r\nimport { GlobalBus } from \"@/bus/global\"\r\nimport { Log } from \"../util/log\"\r\nimport { describeRoute, generateSpecs, validator, resolver, openAPIRouteHandler } from \"hono-openapi\"\r\nimport { Hono } from \"hono\"\r\nimport { cors } from \"hono/cors\"\r\nimport { stream, streamSSE } from \"hono/streaming\"\r\nimport { proxy } from \"hono/proxy\"\r\nimport { Session } from \"../session\"\r\nimport z from \"zod\"\r\nimport { Provider } from \"../provider/provider\"\r\nimport { filter, mapValues, sortBy, pipe } from \"remeda\"\r\nimport { NamedError } from \"@opencode-ai/util/error\"\r\nimport { ModelsDev } from \"../provider/models\"\r\nimport { Ripgrep } from \"../file/ripgrep\"\r\nimport { Config } from \"../config/config\"\r\nimport { File } from \"../file\"\r\nimport { LSP } from \"../lsp\"\r\nimport { Format } from \"../format\"\r\nimport { MessageV2 } from \"../session/message-v2\"\r\nimport { TuiRoute } from \"./tui\"\r\nimport { Permission } from \"../permission\"\r\nimport { Instance } from \"../project/instance\"\r\nimport { Vcs } from \"../project/vcs\"\r\nimport { Agent } from \"../agent/agent\"\r\nimport { Auth } from \"../auth\"\r\nimport { Command } from \"../command\"\r\nimport { ProviderAuth } from \"../provider/auth\"\r\nimport { Global } from \"../global\"\r\nimport { ProjectRoute } from \"./project\"\r\nimport { ToolRegistry } from \"../tool/registry\"\r\nimport { zodToJsonSchema } from \"zod-to-json-schema\"\r\nimport { SessionPrompt } from \"../session/prompt\"\r\nimport { SessionCompaction } from \"../session/compaction\"\r\nimport { SessionRevert } from \"../session/revert\"\r\nimport { lazy } from \"../util/lazy\"\r\nimport { Todo } from \"../session/todo\"\r\nimport { InstanceBootstrap } from \"../project/bootstrap\"\r\nimport { MCP } from \"../mcp\"\r\nimport { Storage } from \"../storage/storage\"\r\nimport type { ContentfulStatusCode } from \"hono/utils/http-status\"\r\nimport { TuiEvent } from \"@/cli/cmd/tui/event\"\r\nimport { Snapshot } from \"@/snapshot\"\r\nimport { SessionSummary } from \"@/session/summary\"\r\nimport { SessionStatus } from \"@/session/status\"\r\nimport { upgradeWebSocket, websocket } from \"hono/bun\"\r\nimport { errors } from \"./error\"\r\nimport { Pty } from \"@/pty\"\r\n\r\n// @ts-ignore This global is needed to prevent ai-sdk from logging warnings to stdout https://github.com/vercel/ai/blob/2dc67e0ef538307f21368db32d5a12345d98831b/packages/ai/src/logger/log-warnings.ts#L85\r\nglobalThis.AI_SDK_LOG_WARNINGS = false\r\n\r\nexport namespace Server {\r\n  const log = Log.create({ service: \"server\" })\r\n\r\n  export const Event = {\r\n    Connected: BusEvent.define(\"server.connected\", z.object({})),\r\n    Disposed: BusEvent.define(\"global.disposed\", z.object({})),\r\n  }\r\n\r\n  const app = new Hono()\r\n  export const App = lazy(() =>\r\n    app\r\n      .onError((err, c) => {\r\n        log.error(\"failed\", {\r\n          error: err,\r\n        })\r\n        if (err instanceof NamedError) {\r\n          let status: ContentfulStatusCode\r\n          if (err instanceof Storage.NotFoundError) status = 404\r\n          else if (err instanceof Provider.ModelNotFoundError) status = 400\r\n          else status = 500\r\n          return c.json(err.toObject(), { status })\r\n        }\r\n        const message = err instanceof Error && err.stack ? err.stack : err.toString()\r\n        return c.json(new NamedError.Unknown({ message }).toObject(), {\r\n          status: 500,\r\n        })\r\n      })\r\n      .use(async (c, next) => {\r\n        const skipLogging = c.req.path === \"/log\"\r\n        if (!skipLogging) {\r\n          log.info(\"request\", {\r\n            method: c.req.method,\r\n            path: c.req.path,\r\n          })\r\n        }\r\n        const timer = log.time(\"request\", {\r\n          method: c.req.method,\r\n          path: c.req.path,\r\n        })\r\n        await next()\r\n        if (!skipLogging) {\r\n          timer.stop()\r\n        }\r\n      })\r\n      .use(cors())\r\n      .get(\r\n        \"/global/event\",\r\n        describeRoute({\r\n          summary: \"Get global events\",\r\n          description: \"Subscribe to global events from the OpenCode system using server-sent events.\",\r\n          operationId: \"global.event\",\r\n          responses: {\r\n      ","description":""},"time":{"start":1765927079740,"end":1765927079847}}}}}


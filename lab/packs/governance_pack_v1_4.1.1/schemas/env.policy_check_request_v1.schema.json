{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://mova.dev/schemas/env.policy_check_request_v1.schema.json",
  "title": "env.policy_check_request_v1",
  "description": "Governance Pack v1: Request to validate a set of candidate tool/actions against a policy profile before execution.",
  "type": "object",
  "properties": {
    "envelope_id": {
      "type": "string",
      "const": "env.policy_check_request_v1"
    },
    "verb": {
      "type": "string",
      "const": "validate"
    },
    "roles": {
      "type": "object",
      "description": "Who requests the check and which policy engine evaluates it.",
      "properties": {
        "producer": {
          "type": "string",
          "description": "Identifier of the producer (agent/IDE/runner)."
        },
        "policy_engine": {
          "type": "string",
          "description": "Identifier of the policy engine / governance adapter."
        }
      },
      "required": [
        "producer",
        "policy_engine"
      ],
      "additionalProperties": false
    },
    "policy_profile_id": {
      "type": "string",
      "description": "Policy profile id to apply (align with global.security_catalog_v1.security_policy_profile)."
    },
    "security_model_version": {
      "type": "string",
      "description": "Security model version used for evaluation."
    },
    "instruction_profile_id": {
      "type": "string",
      "description": "Optional instruction profile id being used for this run (if applicable)."
    },
    "candidate_actions": {
      "type": "array",
      "description": "Planned tool calls to be evaluated.",
      "items": {
        "$ref": "https://mova.dev/schemas/ds.tool_call_provenance_core_v1.schema.json"
      }
    },
    "context": {
      "type": "object",
      "description": "Optional context (repo, branch, paths, environment). Must not include model instructions.",
      "additionalProperties": true
    },
    "meta": {
      "type": "object",
      "description": "Optional metadata for routing/correlation.",
      "additionalProperties": true
    }
  },
  "required": [
    "envelope_id",
    "verb",
    "roles",
    "policy_profile_id",
    "candidate_actions"
  ],
  "additionalProperties": false
}

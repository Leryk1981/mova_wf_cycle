{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://mova.dev/lab/env/env.dpp_export_v1.schema.json",
  "title": "env.dpp_export_v1",
  "description": "Lab-level envelope to request export of a DPP battery passport to external formats (GS1 EPCIS, OPC UA, Catena-X, native JSON).",
  "type": "object",
  "properties": {
    "envelope_type": {
      "type": "string",
      "const": "env.dpp_export_v1"
    },
    "verb": {
      "type": "string",
      "const": "transform"
    },
    "id": {
      "type": "string",
      "description": "Envelope identifier (optional)."
    },
    "time": {
      "type": "string",
      "format": "date-time",
      "description": "Envelope creation time."
    },
    "actor": {
      "type": "object",
      "description": "Actor initiating the export request.",
      "properties": {
        "role": {
          "type": "string"
        },
        "id": {
          "type": "string"
        }
      },
      "additionalProperties": true
    },
    "meta": {
      "type": "object",
      "description": "Additional metadata (domain, labels, correlation id, etc.).",
      "additionalProperties": true
    },
    "roles": {
      "type": "object",
      "properties": {
        "initiator": {
          "type": "string",
          "description": "Who initiates the export (e.g., manufacturer or operator)."
        },
        "transformer": {
          "type": "string",
          "description": "Service or component performing the export (optional)."
        }
      },
      "required": [
        "initiator"
      ],
      "additionalProperties": false
    },
    "data": {
      "type": "object",
      "properties": {
        "passport_id": {
          "type": "string",
          "description": "Battery passport identifier to export."
        },
        "target_format": {
          "type": "string",
          "enum": [
            "gs1_epcis",
            "opc_ua",
            "catena_x",
            "native_json"
          ],
          "description": "Target export format."
        },
        "options": {
          "type": "object",
          "description": "Format-specific export options; domain-specific and not standardized in core.",
          "additionalProperties": true
        },
        "roles": {
          "type": "object",
          "description": "Optional roles override scoped to data for format-specific handling.",
          "properties": {
            "initiator": {
              "type": "string"
            },
            "transformer": {
              "type": "string"
            }
          },
          "required": [
            "initiator"
          ],
          "additionalProperties": false
        }
      },
      "required": [
        "passport_id",
        "target_format"
      ],
      "additionalProperties": false
    }
  },
  "required": [
    "envelope_type",
    "verb",
    "data"
  ],
  "additionalProperties": false
}

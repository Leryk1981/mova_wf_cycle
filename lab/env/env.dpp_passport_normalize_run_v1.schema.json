{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://mova.dev/lab/env/env.dpp_passport_normalize_run_v1.schema.json",
  "title": "DPP Passport Normalize Run (lab)",
  "description": "Envelope for running the DPP passport normalization engine on a single input record.",
  "type": "object",
  "properties": {
    "envelope_type": {
      "type": "string",
      "const": "env.dpp_passport_normalize_run_v1"
    },
    "verb": {
      "type": "string",
      "const": "transform"
    },
    "id": {
      "type": "string",
      "description": "Envelope identifier (optional)."
    },
    "time": {
      "type": "string",
      "format": "date-time",
      "description": "Envelope creation time."
    },
    "actor": {
      "type": "object",
      "description": "Actor initiating the normalize request.",
      "properties": {
        "role": {
          "type": "string"
        },
        "id": {
          "type": "string"
        }
      },
      "additionalProperties": true
    },
    "meta": {
      "type": "object",
      "description": "Additional metadata (domain, labels, correlation id, etc.).",
      "additionalProperties": true
    },
    "roles": {
      "type": "object",
      "properties": {
        "requester": {
          "type": "string",
          "description": "Who triggers normalization (manufacturer or orchestrator)."
        },
        "engine": {
          "type": "string",
          "description": "Normalization engine handling the request (optional)."
        }
      },
      "required": [
        "requester"
      ],
      "additionalProperties": false
    },
    "data": {
      "type": "object",
      "properties": {
        "input": {
          "$ref": "https://mova.dev/lab/schemas/ds.dpp_passport_normalize_input_v1.schema.json"
        },
        "target_schema": {
          "type": "string",
          "enum": [
            "ds.lab_battery_passport_extended_v1"
          ],
          "description": "Target schema id for normalized output. V1 fixed to lab_battery_passport_extended_v1."
        },
        "options": {
          "type": "object",
          "description": "Optional engine options (reserved for future use).",
          "additionalProperties": true
        }
      },
      "required": [
        "input",
        "target_schema"
      ],
      "additionalProperties": false
    }
  },
  "required": [
    "envelope_type",
    "verb",
    "data"
  ],
  "additionalProperties": false
}

# FlashSlot: операторский демо-пак v0

## Что такое FlashSlot
- Пак `packs/flashslot_v0` — детерминированный рантайм для быстрого бэкфилла освободившихся слотов (без внешних SaaS/AI в проде).
- Контракты оффера: `packs/flashslot_v0/ds/ds.flashslot_offer_v1.json`.
- Эксперимент собирает несколько гипотез и выбирает победителя по метрикам доставки.

## Как собрать бизнес-вход (примеры)
- **Стоматология**: тип услуги (чистка/осмотр), время слота, кресло/локация, базовая цена, допустимая скидка, канал (SMS/email/app), сегмент (лояльные, пропустившие визит), крайний срок экспирации.
- **Барбершоп**: услуга (стрижка/борода/комбо), мастер/кресло, длина слота, цена и upsell (уход/маска), канал рассылки, сегмент (VIP/новые/пропуски), правила отмены/переноса.
- **Ресторан**: тип меню/сет, размер стола, окно брони, минимальный чек/депозит, канал (push/email/приложение), сегмент (постоянные/корпоратив/туристы), срок действия оффера.

## Как получить гипотезы A/B/C (внешняя модель)
1. Возьмите собранный бизнес-контекст и передайте его любой модели вне рантайма.
2. Используйте шаблон `packs/flashslot_v0/examples/prompts/prompt_hypothesis_set_v1.md` — он генерирует дескриптор набора + три файла гипотез (A/B/C) с валидными офферами.
3. Сохраните набор (например, `packs/flashslot_v0/examples/hypothesis_set_001_dentist_abc.json`) и три оффера в `packs/flashslot_v0/examples/hypotheses/` или рядом.

## Как получить валидный оффер JSON
- Шаблон `packs/flashslot_v0/examples/prompts/prompt_offer_v1.md` выдаёт чистый JSON под схему `ds.flashslot_offer_v1`.
- Можно вызывать на любую модель (локальную или облачную) — рантайм не зависит от неё.

## Как запустить эксперимент локально (одной командой)
```bash
npm run flashslot:experiment -- --set packs/flashslot_v0/examples/hypothesis_set_001_dentist_abc.json --driver noop --dry-run --out lab/flashslot_runs/<runId>/flashslot_experiment
```
- `--out` опционален: если не указан, CLI положит артефакты в `lab/flashslot_runs/<autogenerated>/flashslot_experiment`.
- `--driver noop` и `--dry-run` оставляют все артефакты и не требуют внешних сервисов.

## Где искать артефакты
- `experiment_summary.json` — сводка по каждому A/B/C и победителю.
- `winner_pack/` — скопированные offer/request/result/stdout/stderr/evidence для победителя.
- `attempts/<hypothesis_id>/` — оффер, входной запрос, результат и логи для каждой гипотезы.
- Смоук для CI без Inngest: `npm run smoke:flashslot:experiment` (использует закоммиченные наборы стоматологии и барбершопа: `hypothesis_set_001_dentist_abc.json`, `hypothesis_set_002_barbershop_abc.json`; noop, dry-run).

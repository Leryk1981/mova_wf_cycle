{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "station_cycle_request_v1",
  "type": "object",
  "properties": {
    "notes": {
      "type": "string",
      "description": "Free-form operator notes for this station cycle."
    },
    "agent_template_request_path": {
      "type": "string",
      "description": "Optional path to the agent_template request JSON used by quality/ship steps."
    },
    "steps": {
      "type": "object",
      "properties": {
        "snapshot": { "$ref": "#/definitions/step_with_request" },
        "gates": { "$ref": "#/definitions/step_toggle" },
        "episode_store": { "$ref": "#/definitions/episode_store_step" },
        "quality_invoice_ap": { "$ref": "#/definitions/quality_step" },
        "quality_gateway": { "$ref": "#/definitions/quality_step" },
        "quality_mcda_matrix": { "$ref": "#/definitions/quality_step" },
        "quality_agent_template": { "$ref": "#/definitions/quality_step" },
        "ship_agent_template": { "$ref": "#/definitions/step_toggle" },
        "finish_branch": { "$ref": "#/definitions/finish_branch_step" },
        "wf_cycle": {
          "type": "object",
          "properties": {
            "scaffold": { "$ref": "#/definitions/step_with_request" },
            "compare": { "$ref": "#/definitions/step_with_request" },
            "winner_pack": { "$ref": "#/definitions/step_with_request" }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    }
  },
  "required": ["steps"],
  "additionalProperties": false,
  "definitions": {
    "step_toggle": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean", "default": false }
      },
      "additionalProperties": false
    },
    "step_with_request": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean", "default": false },
        "request": {
          "type": "object",
          "description": "Payload forwarded to the nested MOVA skill."
        }
      },
      "additionalProperties": false
    },
    "episode_store_step": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean", "default": true },
        "strict": { "type": "boolean", "default": false }
      },
      "additionalProperties": false
    },
    "quality_step": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean", "default": false },
        "run_negative": { "type": "boolean", "default": false },
        "strict": { "type": "boolean", "default": false }
      },
      "additionalProperties": false
    },
    "finish_branch_step": {
      "type": "object",
      "properties": {
        "enabled": { "type": "boolean", "default": true },
        "mode": {
          "type": "string",
          "enum": ["preflight", "report"],
          "default": "preflight"
        },
        "base": {
          "type": "string",
          "default": "origin/main",
          "description": "Base branch reference used for finish_branch."
        }
      },
      "additionalProperties": false
    }
  }
}

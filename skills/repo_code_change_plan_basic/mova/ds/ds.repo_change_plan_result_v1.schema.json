{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://mova.dev/schemas/ds.repo_change_plan_result_v1.schema.json",
  "title": "Repository Code Change Plan Result v1",
  "description": "Structured, step-by-step plan of code changes: which files to touch, in what order, with risks and done-criteria.",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "high_level_overview_md",
    "steps"
  ],
  "properties": {
    "high_level_overview_md": {
      "type": "string",
      "description": "1–3 paragraphs: what we are going to do, which parts of the repo will be affected, what the expected result is."
    },
    "steps": {
      "type": "array",
      "minItems": 1,
      "description": "Step-by-step plan of changes.",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "step_id",
          "title",
          "summary_md",
          "change_kind",
          "target_files"
        ],
        "properties": {
          "step_id": {
            "type": "string",
            "description": "Simple identifier for the step (e.g., 'S1', 'S2', 'S3')."
          },
          "title": {
            "type": "string",
            "description": "Short title of the step, e.g. 'Add connector skill skeleton for Cloudflare KV'."
          },
          "summary_md": {
            "type": "string",
            "description": "2–8 lines describing what exactly needs to be done in this step (in human language, without diffs)."
          },
          "change_kind": {
            "type": "string",
            "enum": [
              "create_file",
              "modify_file",
              "delete_file",
              "rename_file",
              "config_update",
              "docs_update",
              "tests_update",
              "refactor"
            ],
            "description": "Type of change: 'create_file', 'modify_file', 'delete_file', 'rename_file', 'config_update', 'docs_update', 'tests_update', 'refactor'."
          },
          "target_files": {
            "type": "array",
            "minItems": 1,
            "description": "Files/directories that this step will touch.",
            "items": {
              "type": "object",
              "additionalProperties": false,
              "required": [
                "path"
              ],
              "properties": {
                "path": {
                  "type": "string",
                  "description": "Path relative to repository root, e.g. 'skills/connectors_cloudflare_kv/mova/ds/ds.cloudflare_kv_get_request_v1.schema.json'."
                },
                "role": {
                  "type": "string",
                  "enum": [
                    "primary",
                    "secondary"
                  ],
                  "description": "Role of this file: 'primary' (main place for changes), 'secondary' (supporting file, e.g. README, test)."
                },
                "notes": {
                  "type": "string",
                  "description": "Clarification about role/content, e.g. 'new file', 'update existing manifest', 'ensure tests cover retry logic'."
                }
              }
            }
          },
          "dependencies": {
            "type": "array",
            "description": "List of step_id values that must be completed BEFORE this step.",
            "items": {
              "type": "string"
            }
          },
          "risk_level": {
            "type": "string",
            "enum": [
              "low",
              "medium",
              "high"
            ],
            "description": "Risk level for this step: 'low', 'medium', 'high'."
          },
          "risk_notes_md": {
            "type": "string",
            "description": "Brief explanation of risks for this step (possible regressions, impact on other parts)."
          },
          "done_criteria_md": {
            "type": "string",
            "description": "How to understand that the step is complete, e.g. 'new connector is generated and npm run validate passes'."
          }
        }
      }
    },
    "global_risks_md": {
      "type": "string",
      "description": "Global risks for the entire plan (large-scale changes, possible downtime, migrations)."
    },
    "checklist_for_human": {
      "type": "array",
      "description": "Short list of 'ToDo' items for the developer, e.g. 'go through all steps S1–S4 in dependency order', 'after completion – run full test suite and deploy'.",
      "items": {
        "type": "string"
      }
    }
  }
}

